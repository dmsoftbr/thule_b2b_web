import{r as o,a2 as Le,j as e,g as V,a3 as ke,l as te,t as E,a4 as Ue,i as Qe,e as Oe,a5 as Ge,h as We}from"./index-C-yn2kxu.js";import{c as z,B as T}from"./index-Cj-kxx9Z.js";import{e as He,C as Ke,a as Ye,b as Je,c as Xe,d as Ze}from"./command-DF-KUbv3.js";import{P as es,a as ss,b as rs}from"./popover-D4FvDG7G.js";import{P as ae}from"./product-image-870267Xw.js";import{C as ts}from"./chevrons-up-down-DXmsIWP1.js";import{L as S}from"./label-PvIEZhsH.js";import{F as xe,C as as}from"./customers-combo-_cQgQrs3.js";import{B as ue,S as H,c as se}from"./search-combo-DoY-PKU3.js";import{C as is,d as ns}from"./card-oCMkmh1O.js";import{f as ls}from"./datetime-utils-C1Y3PBw1.js";import{f as C,r as Ce}from"./number-utils-BjpbXa09.js";import{A as G}from"./app-tooltip-1VY1K540.js";import{v as q}from"./v4-BKrj-4V8.js";import{u as Ve}from"./use-auth-BWk16BUZ.js";import{P as re}from"./plus-CfhVh8qF.js";import{M as me}from"./minus-Cc6YOJ9G.js";import{C as os}from"./calendar-ZEkurVXL.js";import{S as ds}from"./scroll-area-Bnzc--3Y.js";import{S as cs}from"./server-table-OrazAZj6.js";import{D as K,e as ie,a as Y,b as J,c as X,d as Z,f as ee}from"./dialog-o4W0LXdK.js";import{S as us}from"./search-8CyYJVSP.js";import{P as xs,S as ms,T as hs,C as ps,B as fs,U as js,L as gs}from"./undo-2-C7pzZxCh.js";import{b as L,e as O,T as he,a as pe,c as I,d as fe,f as bs}from"./table-D5BP3akl.js";import{T as vs}from"./trash-DuwzUJ5T.js";import{f as Ns}from"./format-yjuT46Nz.js";import{I as W}from"./input-Dr2m_CVc.js";import{f as ys}from"./string-utils-DZ7LWdPC.js";import{T as Cs}from"./tree-checkbox-D0r5Lhfv.js";import{u as Is}from"./useQuery-BEMaX6S8.js";import{C as Q}from"./checkbox-BvWHDgRj.js";import{R as ws,a as Ps}from"./radio-group-SbalYX0g.js";import{N as Ss}from"./react-number-format.es-C6TcdqBX.js";import{S as Ie,a as we,b as Pe,c as Se,d as _}from"./select-BqrgrOas.js";import{D as Te}from"./date-picker-BTPigZqt.js";import{I as Ts}from"./index-yFKSUj0c.js";import{L as ce}from"./loader-circle-BV1pYLGQ.js";import{D as Ds,a as ks,b as Os,c as De,d as Vs}from"./dropdown-menu-3YsRMfS2.js";import{C as Es}from"./chevron-down-lpqsW9lE.js";const Ee=o.createContext(void 0),Fr=({children:s,initialOrder:m,formMode:u})=>{const d=m?.isBudget??!1,[r,c]=o.useState(()=>m??{...Le,isBudget:d}),[x,f]=o.useState(()=>u??"VIEW"),n=p=>{c(b=>({...b,isBudget:p}))},y=p=>{c(b=>({...b,customer:p,customerId:p.id,branchId:p.branchId,paymentConditionId:p.paymentConditionId,paymentCondition:p.paymentCondition}))},w=p=>{c(b=>({...b,discountPercentual:p}))},D=()=>{c(p=>({...p,items:[]}))},a=p=>{c(b=>({...b,representativeId:p.id,representative:p}))},v=p=>{c(b=>({...b,deliveryLocationId:p.id,deliveryLocation:p}))},l=p=>{p.id=q();const b=[...r.items,p];c(P=>({...P,items:b}))},N=p=>{const b=[...r.items.filter(P=>P.id!=p.id),p];c(P=>({...P,items:b}))},k=p=>{const b=[...r.items.filter(P=>P.id!=p.id)];c(P=>({...P,items:b}))},B=()=>r.items.reduce((p,b)=>p+b.orderQuantity*b.inputPrice,0),R=()=>{let p=0;for(let b of r.items)b.taxes&&(p+=b.taxes.reduce((P,U)=>P+U.taxValue,0));return p};return e.jsx(Ee.Provider,{value:{order:r,setOrder:c,setCustomer:y,setDiscountPercentual:w,clearItems:D,setRepresentative:a,setDeliveryLocation:v,addItem:l,updateItem:N,removeItem:k,getTotalOrderWithDiscount:B,getOrderTotalTaxes:R,mode:x,setMode:f,isBudget:d,setIsBudget:n},children:s})},F=()=>{const s=o.useContext(Ee);if(s===void 0)throw new Error("useOrder must be used within an OrderProvider");return s},Fs=({customerId:s,priceTableId:m,className:u,disabled:d,onSelect:r,closeOnSelect:c=!1})=>{const[x,f]=o.useState(!1),[n,y]=o.useState([]),[w,D]=o.useState(!1),[a,v]=o.useState(""),l=o.useRef(null),N=o.useRef(void 0),k=o.useRef(null),B=o.useMemo(()=>{if(!a)return"";const j=n.find(A=>A.id===a);return j?`${j.id} - ${j.description}`:""},[a,n]),R=o.useCallback(async j=>{if(k.current&&k.current.abort(),!j.trim()){y([]),D(!1);return}D(!0),k.current=new AbortController;try{const{data:A}=await V.post("/registrations/products/search",{search:j,customerId:s,priceTableId:m},{signal:k.current.signal});y(A)}catch(A){A.name!=="AbortError"&&(console.error("Erro na busca:",A),y([]))}finally{D(!1)}},[s,m]),p=o.useCallback(j=>{N.current&&clearTimeout(N.current),N.current=window.setTimeout(()=>{R(j)},300)},[R]),b=o.useCallback(j=>{v(""),r?.(j),c&&f(!1),l.current&&(l.current.value="",l.current.focus()),y([])},[r,c]),P=o.useMemo(()=>({item:j})=>e.jsx(He,{disabled:!j.isActive,value:j.id.toString(),onSelect:()=>b(j),keywords:[j.id,j.referenceCode,j.description],className:z("even:bg-neutral-50 border-t rounded-none",u,a===j.id.toString()&&"!bg-blue-100"),children:e.jsxs("div",{className:"grid grid-cols-[128px_1fr] gap-2",children:[e.jsx("div",{className:"w-[128px] h-[128px] relative bg-transparent flex-shrink-0",children:e.jsx(ae,{productId:`${j.id}`,alt:"Foto do Produto"})}),e.jsxs("div",{className:"flex flex-col justify-center min-w-0",children:[e.jsxs("span",{className:"font-bold text-blue-600 truncate",children:[j.id," - ",j.description]}),e.jsxs("p",{className:"text-xs text-muted-foreground truncate",children:["Classificação: ",j.productGroup?.name]})]})]})},j.id),[u,a,b]),U=o.useCallback(j=>{f(j),j||(N.current&&clearTimeout(N.current),k.current&&k.current.abort())},[]);return e.jsxs(es,{open:x,onOpenChange:U,children:[e.jsx(ss,{asChild:!0,disabled:d,children:e.jsxs(T,{type:"button",variant:"outline",role:"combobox",className:"w-full flex-1 justify-between hover:not-disabled:!bg-white",children:[a?B:w?"Procurando...":"Selecione o Produto",e.jsx(ts,{className:"opacity-50"})]})}),e.jsx(rs,{className:"p-0 w-popover",children:e.jsxs(Ke,{shouldFilter:!1,children:[e.jsx(Ye,{ref:l,placeholder:"Procurar...",className:"h-9",onValueChange:p}),e.jsxs(Je,{children:[e.jsx(Xe,{children:w?"Carregando...":a?"Produto não cadastrado na lista de preço ou não disponível para seu canal de vendas.":"Digite o termo a procurar: Código Longo/Código Curto/Descrição"}),e.jsx(Ze,{className:"p-0",children:n.map(j=>e.jsx(P,{item:j},j.id))})]})]})})]})},Fe=()=>e.jsx("div",{className:"p-1",children:e.jsxs("div",{className:"flex flex-col space-y-6 mt-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"mr-2 bg-emerald-500 text-white px-2 py-1.5 rounded text-xs",children:"C"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Confirmado: "}),"Produto disponível no estoque"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"mr-2 bg-red-300 text-white px-2 py-1.5 rounded text-xs",children:"B"}),e.jsxs("span",{children:[e.jsx("strong",{children:"BackOrder: "}),"Produto Indisponível no estoque"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"mr-2 ml-4 bg-red-500 text-white px-2 py-1.5 rounded text-xs",children:"B2"}),e.jsx("strong",{children:"BackOrder B2: "}),"Produto em Tropicalização"]}),e.jsxs("div",{children:[e.jsx("span",{className:"mr-2 ml-4 bg-pink-500 text-white px-2 py-1.5 rounded text-xs",children:"B3"}),e.jsx("strong",{children:"BackOrder B3: "}),"Produto Indisponível no estoque com previsão de chegada"]}),e.jsxs("div",{children:[e.jsx("span",{className:"mr-2 ml-4 bg-purple-500 text-white px-2 py-1.5 rounded text-xs",children:"B4"}),e.jsx("strong",{children:"BackOrder B4: "}),"Produto Indisponível no estoque e sem previsão de chegada"]}),e.jsxs("div",{children:[e.jsx("span",{className:"mr-2 bg-blue-300 text-white px-2 py-1.5 rounded text-xs",children:"P"}),e.jsx("span",{children:"Parcial"})]})]})}),Bs=({data:s,className:m})=>{const{updateItem:u,removeItem:d,order:r,mode:c}=F(),{session:x}=Ve(),f=c=="NEW"||c=="EDIT",n=async w=>{var D={orderId:r.id,customerAbbreviation:r.customerAbbreviation,productId:s.productId,quantity:w};const{data:a}=await V.post("/stock/caculate-delivery-date",D),v={...s,orderQuantity:Number(w),deliveryDate:a.estimatedDate,availability:a.availbility};u(v)},y=()=>{d(s)};return e.jsx("div",{className:z("flex flex-col border-neutral-100  border-x border-b first:border-t-0 last:border-b-0",m),children:e.jsx("div",{className:"",children:e.jsx(is,{className:"overflow-hidden rounded-none border-none",children:e.jsx(ns,{className:"px-6 w-full",children:e.jsxs("div",{className:"grid grid-cols-[200px_1fr]",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(ae,{productId:s.productId,alt:""})}),e.jsxs("div",{className:"flex-1 min-w-0 flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 truncate pr-4",children:s.product?.id}),f&&e.jsx(T,{variant:"link",size:"sm",onClick:()=>y(),className:"text-red-600 hover:text-red-700 hover:bg-red-50 underline text-sm ",children:"Remover"})]}),e.jsx("p",{className:"text-gray-600 text-sm line-clamp-2",children:s.product?.description}),e.jsxs("div",{className:"text-sm font-bold text-gray-900",children:["Tabela de Preço:",e.jsx(ue,{variant:"destructive",className:"ml-1",children:s.priceTableId})]}),e.jsxs("div",{className:"text-lg font-bold text-gray-900",children:["Preço Sugerido Consumidor: R$"," ",C(s.suggestPrice,2)]}),e.jsxs("div",{className:"text-lg font-bold text-gray-900",children:["Preço Tabela: R$ ",C(s.inputPrice,2)]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsx("div",{className:"flex items-center border rounded-lg gap-x-4",children:e.jsx(xe,{min:1,disabled:!f,value:s.orderQuantity,onValueChange:w=>n(w),minusSlot:e.jsx(me,{className:"size-3"}),plusSlot:e.jsx(re,{className:"size-3"})})})}),e.jsxs("div",{className:"flex items-center font-bold text-lg",children:["Total: R$"," ",C(s.orderQuantity*s.inputPrice,2)]})]}),e.jsxs("div",{className:"flex items-center mt-2",children:[e.jsx(G,{message:e.jsx(Fe,{}),className:"bg-neutral-100 text-black shadow-lg border",indicatorClassName:"fill-neutral-100 bg-neutral-100 shadow",children:e.jsx(ue,{variant:"outline",className:z("select-none mr-4",ke(s.availability)),children:s.availability})}),e.jsx("div",{className:"flex flex-wrap gap-3 items-center justify-center",children:e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(os,{className:"h-4 w-4 mr-1"}),e.jsxs("span",{children:["Prev. Entrega: ",ls(s.deliveryDate)]})]})})]}),x?.user.role==0&&e.jsx("p",{className:"text-xs",children:s.fiscalOperationId})]})]})})},`${s.sequence}_${s.productId}`)})})},Rs=({initialPriceTable:s})=>{const[m,u]=o.useState(!1),{order:d,setOrder:r}=F(),[c,x]=o.useState(s),[f,n]=o.useState(new Date().valueOf()),{showAppDialog:y}=te();function w(a,v,l){if(!a){E.warning("Selecione a tabela de preço");return}l||(l=1),l==0&&(l=1);const N={...d},k=N.items.findIndex(B=>B.productId==v.id);k>=0?(N.items[k].orderQuantity=l,E.success("Quantidade atualizada!")):(N.items.push({availability:"C",deliveryDate:new Date,sequence:0,orderId:d.id,product:v,productId:v.id,orderQuantity:l,grossItemValue:l*v.unitPriceInTable,inputPrice:v.unitPriceInTable,suggestPrice:v.suggestUnitPrice,allocatedQuantity:0,comments:"",customerAbbreviation:d.customerAbbreviation,deliveredQuantity:0,fiscalOperationId:"",id:q(),ncm:"",netItemValue:0,originalDeliveryDate:new Date,priceTablePrice:v.unitPriceInTable,referenceCode:v.referenceCode,statusId:1,priceTableId:a.id,priceTable:a,taxes:[],costValue:0}),E.success("Produto adicionado no pedido!")),r(N)}const D=[{key:"photo",dataIndex:"id",title:"Produto",renderItem:a=>e.jsx("div",{className:"size-14",children:e.jsx(ae,{productId:a.id,alt:"Foto do Produto",className:"size-14",onClick:v=>window.open(v,"_blank")})}),sortable:!0},{key:"id",dataIndex:"id",title:"Código",renderItem:a=>e.jsx("span",{className:"font-semibold text-blue-600 ",children:a.id}),sortable:!0},{key:"referenceCode",dataIndex:"referenceCode",title:"Código Curto",renderItem:a=>e.jsx("span",{className:"font-semibold text-blue-600 text-sm",children:a.referenceCode}),sortable:!0},{key:"description",dataIndex:"description",title:"Descrição",renderItem:a=>e.jsx("span",{className:"text-sm",children:a.description}),sortable:!0},{key:"familyName",dataIndex:"family.name",title:"Família",renderItem:a=>e.jsx("span",{className:"text-sm",children:a.productFamily?.name}),sortable:!0},{key:"PreçoSug",dataIndex:"suggestUnitPrice",title:"Preço Sugerido",renderItem:a=>e.jsx("div",{className:"font-semibold text-blue-600 w-full text-right",children:C(a.suggestUnitPrice,2)}),sortable:!0},{key:"PrecoTabela",dataIndex:"unitPriceInTable",title:"Preço Tabela",renderItem:a=>e.jsx("div",{className:"font-semibold w-full text-right text-blue-600 ",children:C(a.unitPriceInTable,2)}),sortable:!0},{key:"qty",dataIndex:"id",title:"Quantidade",renderItem:a=>e.jsx(xe,{min:0,max:999999,step:1,minusSlot:e.jsx(me,{className:"size-3"}),plusSlot:e.jsx(re,{className:"size-3"}),value:a.quantity??1,onValueChange:v=>a.quantity=v??0}),sortable:!1},{key:"actions",dataIndex:"id",title:"Ações",renderItem:a=>e.jsx("div",{children:e.jsxs(T,{onClick:async()=>{if(!c){E.warning("Selecione a Tabela de Preço");return}a.orderMessage?await y({message:a.orderMessage,title:"ATENÇÃO",type:"warning",buttons:[{text:"OK",autoClose:!0}],onClose:()=>{w(c,a,a.quantity<1?1:a.quantity)}}):w(c,a,a.quantity<1?1:a.quantity)},children:[e.jsx(re,{className:"size-4"}),"Adicionar"]})}),sortable:!1}];return e.jsxs(K,{open:m,onOpenChange:u,children:[e.jsx(ie,{asChild:!0,children:e.jsx(T,{type:"button",onClick:()=>u(!0),children:e.jsx(us,{className:"w-4 h-4"})})}),e.jsxs(Y,{className:"min-w-[90%]",children:[e.jsxs(J,{children:[e.jsx(X,{children:"Pesquisar Produtos"}),e.jsx(Z,{})]}),e.jsx("div",{className:"flex flex-col w-full",children:e.jsx(cs,{searchSlot:e.jsx(G,{message:"Tabela de Preço",children:e.jsx(H,{className:"h-9.5 min-w-[200px]",defaultValue:d.customer?.priceTables[0].id,staticItems:se(d.customer?.priceTables??[],"id","portalName"),onSelectOption:a=>{x(a[0].extra?.priceTable),n(new Date().valueOf())}})}),columns:D,dataUrl:"/registrations/products/list-paged-price-table",searchFields:[],defaultPageSize:8,defaultSearchField:"all",defaultSortFieldDataIndex:"suggestUnitPrice",defaultSortDesc:!0,additionalInfo:{priceTableId:c?.id??"",customerId:d.customerId??0}},f)}),e.jsx(ee,{children:e.jsx(T,{onClick:()=>u(!1),children:"Fechar"})})]})]})},As=()=>e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 w-full opacity-40",children:[e.jsx(xs,{className:"h-12 w-12 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Nenhum produto adicionado"}),e.jsx("p",{className:"text-gray-500 text-center",children:"Adicione alguns itens para começar seu pedido."})]}),$s=({item:s})=>{const{order:m,removeItem:u,updateItem:d,mode:r}=F(),c=r=="NEW"||r=="EDIT",x=async f=>{if(!f){u(s);return}var n={orderId:m.id,customerAbbreviation:m.customerAbbreviation,productId:s.productId,quantity:f};const{data:y}=await V.post("/stock/caculate-delivery-date",n),w={...s,orderQuantity:Number(f),deliveryDate:y.estimatedDate,availability:y.availbility};d(w)};return e.jsxs(L,{className:"flex w-full even:bg-muted",children:[e.jsx(O,{className:"border-r border-l p-1 w-[72px]",children:e.jsx(ae,{productId:s.productId,alt:s.productId,isThumb:!0,expandOnClick:!0,className:"hover:bg-neutral-100 cursor-pointer max-w-[64px] max-h-[64px]"})}),e.jsxs(O,{className:"flex-1 border-r flex flex-col",children:[e.jsx("span",{className:"font-semibold text-blue-600",children:s.productId}),e.jsx("span",{children:s.product?.description})]}),e.jsx(O,{className:"border-r text-right w-[160px]",children:e.jsx(xe,{plusSlot:e.jsx(re,{className:"size-3"}),minusSlot:e.jsx(me,{className:"size-3"}),disabled:!c,value:s.orderQuantity,onValueChange:f=>x(f??0)})}),e.jsx(O,{className:"w-[120px] border-r text-right",children:C(s.suggestPrice,2)}),e.jsx(O,{className:"w-[120px] border-r text-right",children:C(s.inputPrice,2)}),e.jsx(O,{className:"w-[120px] border-r text-right",children:C(s.inputPrice*s.orderQuantity,2)}),e.jsxs(O,{className:"w-[120px] border-r flex-wrap ",children:[Ns(s.deliveryDate,"dd/MM/yyyy")," ",e.jsx(G,{message:e.jsx(Fe,{}),className:"bg-neutral-100 text-black shadow-lg border",indicatorClassName:"fill-neutral-100 bg-neutral-100 shadow",children:e.jsx(ue,{variant:"outline",className:z("select-none mr-4",ke(s.availability)),children:s.availability})})]}),e.jsxs(O,{className:"w-[120px] border-r text-right",children:[C((s.suggestPrice-s.priceTablePrice)/(s.suggestPrice==0?1:s.suggestPrice)*100,2),"%"]}),e.jsxs(O,{className:"w-[120px] border-r text-right",children:[C((s.suggestPrice-s.priceTablePrice)/(s.priceTablePrice==0?1:s.priceTablePrice)*100,2),"%"]}),e.jsx(O,{className:"border-r w-[100px]",children:c&&e.jsx("div",{className:"flex flex-wrap gap-1.5",children:e.jsx(T,{size:"icon",variant:"destructive",onClick:()=>u(s),children:e.jsx(vs,{})})})}),e.jsx(O,{className:"p-0 w-[17px] border-r"})]})},_s=()=>{const{order:s,getTotalOrderWithDiscount:m}=F();return e.jsxs(he,{className:"w-full table-fixed text-xs flex flex-col",children:[e.jsx(pe,{className:"flex",children:e.jsxs(L,{className:"flex w-full hover:bg-neutral-300 bg-neutral-300",children:[e.jsx(I,{className:"w-[72px] border flex items-center text-xs text-black",children:"Imagem"}),e.jsx(I,{className:"flex-1 border flex items-center text-xs text-black",children:"Produto"}),e.jsx(I,{className:"w-[160px] border flex items-center text-xs text-black",children:"Qtde"}),e.jsxs(I,{className:"w-[120px] border flex items-center justify-center text-center flex-col break-words text-xs text-black",children:[e.jsx("span",{children:"Preço"}),e.jsx("span",{children:"Sugerido Cons."})]}),e.jsxs(I,{className:"w-[120px] border flex items-center justify-center text-center flex-col break-words text-xs text-black",children:[e.jsx("span",{children:"Preço"}),e.jsx("span",{children:"Tabela"})]}),e.jsxs(I,{className:"w-[120px] border flex items-center justify-center text-center flex-col break-words text-xs text-black",children:[e.jsx("span",{children:"Total"}),e.jsx("span",{children:"c/Desconto"})]}),e.jsx(I,{className:"w-[120px] border flex items-center justify-center text-center flex-col break-words text-xs text-black",children:"Prev. Entrega"}),e.jsx(I,{className:"w-[120px] border flex items-center justify-center text-center flex-col break-words text-xs text-black",children:"Markup"}),e.jsx(I,{className:"w-[120px] border flex items-center justify-center text-center flex-col break-words text-xs text-black",children:"Margem"}),e.jsx(I,{className:"w-[100px] border flex items-center text-xs text-black",children:"Ações"}),e.jsx(I,{className:"w-[17px] max-w-[17px]"})]})}),e.jsxs(fe,{className:"flex flex-col overflow-y-visible w-full",style:{maxHeight:"230px"},children:[s.items.length==0&&e.jsx("tr",{className:"h-10",children:e.jsx("td",{className:"flex items-center justify-center h-10 border",colSpan:9,children:"Sem Itens no Pedido"})}),s.items?.map((u,d)=>e.jsx($s,{item:u},d))]}),e.jsx(bs,{className:"flex w-full",children:e.jsxs(L,{className:"flex w-full bg-neutral-300 align-middle text-sm hover:bg-neutral-300",children:[e.jsx(I,{colSpan:2,className:"flex-1 border-[0.5px] flex items-center",children:"Total"}),e.jsx(I,{className:" border-[0.5px] w-[160px]  flex items-center justify-end",children:s.items?.reduce((u,d)=>u+=d.orderQuantity,0)}),e.jsx(I,{colSpan:2,className:"w-[240px] border-[0.5px]"}),e.jsx(I,{className:"w-[120px] border-[0.5px] text-right  flex items-center justify-end",children:C(m(),2)}),e.jsx(I,{className:"w-[460px] border-r"}),e.jsx(I,{className:"w-[17px]"})]})})]})},qs=()=>{const{order:s,addItem:m,mode:u}=F(),[d,r]=o.useState(!0),{showAppDialog:c}=te(),[x,f]=o.useState(s.customer?.priceTables[0]??{id:"PrBase",isOutlet:!1,name:"PrBase",validFrom:new Date(2e3,1,1),validTo:new Date(2072,12,31),zeroDiscount:!1,isActive:!0,isException:!1,portalName:""}),n=u=="NEW"||u=="EDIT";if(!s.customer)return e.jsx("div",{className:"w-full p-2 flex flex-col items-center min-h-[100px]",children:e.jsx("div",{className:"my-4",children:"Selecione o Cliente para poder selecionar os Produtos"})});const w=async l=>{if(!x){E.warning("Selecione a tabela de Preço");return}l&&(l.orderMessage?await c({message:l.orderMessage,title:"ATENÇÃO",type:"warning",buttons:[{text:"OK",autoClose:!0}],onClose:async()=>{D(l)}}):D(l))};async function D(l){if(s.items&&s.items?.findIndex(b=>b.productId.toLowerCase()===l.id.toLowerCase())>=0){E.warning("Produto já consta no pedido!");return}var N={orderId:s.id,customerAbbreviation:s.customerAbbreviation,productId:l.id,quantity:1};const{data:k}=await V.post("/stock/caculate-delivery-date",N);var B={branchId:s.branchId,customerAbbreviation:s.customer?.abbreviation,productId:l.id,fiscalOperationId:s.customer?.fiscalOperationId};const{data:R}=await V.post("/order-items/matriz-cfop-item",B),p={...Ue,...l,productId:l.id,product:l,deliveryDate:k.estimatedDate,availability:k.availbility,inputPrice:l.unitPriceInTable,suggestPrice:l.suggestUnitPrice,priceTablePrice:l.unitPriceInTable,grossItemValue:l.unitPriceInTable*1,orderQuantity:1,sequence:s.items.length+10,taxes:[],priceTable:x,priceTableId:x.id,costValue:0,fiscalOperationId:R};m(p),E.success("Produto adicionado ao pedido",{duration:1e3})}const a=s.items.reduce((l,N)=>l+N.inputPrice*N.orderQuantity,0),v=s.items.sort((l,N)=>l.sequence-N.sequence);return e.jsxs("div",{className:"w-full p-2 container flex flex-col items-center",children:[e.jsx("div",{className:"flex gap-x-4 mb-2 container w-full",children:e.jsx("div",{className:"flex flex-1 items-center justify-center",children:e.jsxs("div",{className:"flex gap-x-2 w-full items-end",children:[s.orderClassificationId<6&&n?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex-0 form-group",children:[e.jsx(S,{children:"Tabela de Preço"}),e.jsx(H,{className:"h-9.5 min-w-[200px]",defaultValue:s.customer?.priceTables[0].id,staticItems:se(s.customer?.priceTables??[],"id","portalName"),onSelectOption:l=>f(l[0].extra)})]}),e.jsxs("div",{className:"flex-1 form-group",children:[e.jsx(S,{children:"Pesquisar Produto para Adicionar"}),e.jsx(Fs,{onSelect:w,priceTableId:s.customer?.priceTables[0].id??"",customerId:s.customerId,closeOnSelect:!0})]}),e.jsx(Rs,{initialPriceTable:x})]}):e.jsx("div",{}),e.jsxs("div",{className:"flex items-center gap-x-1",children:[e.jsx(G,{message:"Ver em Cards",className:"bg-emerald-700",indicatorClassName:"!bg-emerald-700 fill-emerald-700",children:e.jsx("button",{type:"button",onClick:()=>r(!0),className:z("flex items-center justify-center p-1 bg-neutral-50 rounded-md size-9 border-neutral-200 border cursor-pointer hover:bg-emerald-600 hover:text-white transition-colors",d&&"bg-emerald-500 border-0 text-white"),children:e.jsx(ms,{className:"size-4"})})}),e.jsx(G,{message:"Ver em Tabela",className:"bg-emerald-700",indicatorClassName:"!bg-emerald-700 fill-emerald-700",children:e.jsx("button",{type:"button",onClick:()=>r(!1),className:z("flex items-center justify-center p-1 bg-neutral-50 rounded-md size-9 border-neutral-200 border cursor-pointer hover:bg-emerald-600 hover:text-white transition-colors",!d&&"bg-emerald-500 border-0 text-white"),children:e.jsx(hs,{className:"size-4"})})})]})]})})}),!d&&e.jsx(_s,{}),d&&e.jsxs("div",{className:z("grid grid-cols-[70%_30%] border-y w-full",!s.items&&"grid-cols-1 border-0"),children:[e.jsxs(ds,{className:"",style:{height:"calc(100vh - 330px)"},type:"always",children:[!s.items?.length&&e.jsx(As,{}),v.map((l,N)=>e.jsx(Bs,{data:l,className:"even:bg-neutral-300"},`${l.productId}_${N}`))]}),v&&e.jsxs("div",{className:"border-x  flex items-center justify-center flex-col",children:[e.jsxs("div",{className:"flex items-center text-lg font-semibold",children:["Total ",s.isBudget?"da Simulação":"do Pedido",": R$"," ",C(a,2),e.jsx("div",{className:"text-xs font-semibold bg-neutral-700 text-white rounded px-1.5 py-0.5 flex items-center justify-center ml-2",children:`(${s.items.length}) ${s.items.length>1?"itens":"item"}`}),e.jsx("div",{className:"text-xs font-semibold bg-neutral-500 text-white rounded px-1.5 py-0.5 flex items-center justify-center ml-2",children:`(${s.items.reduce((l,N)=>l+=N.orderQuantity,0)}) qtde total`})]}),e.jsxs("div",{className:"text-green-600 font-semibold",children:["Desconto: R$"," ",C(a*(s.discountPercentual/100),2)]}),e.jsxs("div",{className:"text-xl font-bold",children:["Total com Desconto: R$"," ",C(a*(1-s.discountPercentual/100),2)]})]})]})]})},zs=()=>{const{order:s,setCustomer:m,setRepresentative:u,setDiscountPercentual:d,setDeliveryLocation:r,clearItems:c,mode:x}=F(),{showAppDialog:f}=te(),n=x=="NEW"||x=="EDIT",y=n&&s.orderId=="";function w(a){return a?a.creditStatus=="3"||a.creditStatus=="4"?(f({title:"Cliente",message:"Cliente suspenso para implantação de pedidos, por favor, entre em contato com a Thule.",type:"warning"}),!1):(m(a),u(a.representative),d(a.discountPercent),a.deliveryLocations&&a.deliveryLocations.length>0&&r(a.deliveryLocations[0]),!0):!1}const D=async(a,v,l,N)=>{if(!v){l();return}console.log(a?.id),s.items.length>0?await f({message:"Se trocar o cliente o pedido será redefinido",title:"Atenção",type:"confirm",buttons:[{text:"Trocar",variant:"danger",value:!0,autoClose:!0},{text:"Cancelar",variant:"secondary",value:!1,autoClose:!0}]})?(c(),l()):N():l()};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:" grid grid-cols-5 gap-x-4 p-2 bg-neutral-50",children:[e.jsx("div",{className:"space-y-2 col-span-2",children:e.jsxs("div",{className:"form-group",children:[e.jsx(S,{children:"Cliente"}),(!n||!y)&&e.jsxs("div",{className:"text-sm border px-2.5 rounded-md py-1.5 bg-neutral-100 text-black font-medium",children:[`${s.customerId} - ${s.customer?.abbreviation}`," - ",e.jsxs("span",{className:"text-xs text-muted-foreground",children:["CPF/CNPJ:"," ",ys(s.customer?.documentNumber??"")]})]}),y&&e.jsx(as,{defaultValue:s.customerId||void 0,disabled:!n,onSelect:a=>w(a),closeOnSelect:!0,onPreSelect:D})," "]})}),e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"form-group",children:[e.jsx(S,{children:"Representante"}),e.jsx(H,{defaultValue:s.representativeId.toString(),apiEndpoint:"/registrations/representatives/all",labelProp:"abbreviation",valueProp:"id",disabled:!n})]})}),e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"form-group",children:[e.jsx(S,{children:"% Desconto"}),e.jsx(W,{className:"text-right",readOnly:!0,value:C(s.discountPercentual,2)??"0,00"})]})})]})})},Ms=()=>{const[s,m]=o.useState(!1);return e.jsxs(K,{open:s,onOpenChange:m,children:[e.jsx(ie,{asChild:!0,children:e.jsxs(T,{variant:"outline",size:"sm",type:"button",onClick:()=>m(!0),children:[e.jsx(ps,{className:"size-4"}),"Matriz de Descontos"]})}),e.jsxs(Y,{className:"min-w-[30%]",children:[e.jsxs(J,{children:[e.jsx(X,{children:"Matriz de Desconto"}),e.jsx(Z,{children:"Descontos Progressivos conforme o Valor do Pedido"})]}),e.jsx("div",{className:"flex flex-col space-y-6 mt-2",children:e.jsxs(he,{className:"border",children:[e.jsx(pe,{children:e.jsxs(L,{className:"bg-neutral-200",children:[e.jsx(I,{className:"border border-neutral-300",children:"Do Valor do Pedido"}),e.jsx(I,{className:"border border-neutral-300",children:"Ao Valor do Pedido"}),e.jsx(I,{className:"border border-neutral-300",children:"% Desconto"}),e.jsx(I,{className:"border border-neutral-300",children:"Cond. Pagto"})]})}),e.jsx(fe,{children:e.jsx(L,{children:e.jsx(O,{colSpan:4,className:"text-center",children:"Sem Descontos Liberados"})})})]})}),e.jsx(ee,{children:e.jsx(T,{onClick:()=>m(!1),children:"Fechar"})})]})]})},Ls=()=>{const[s,m]=o.useState(!1),{order:u}=F(),d=Qe(),{data:r}=Is({queryKey:["sales-group-tree-data"],queryFn:async()=>{if(!u.customer||!u.customer.salesGroup||u.customer.salesGroup.length==0)return[];const{data:c}=await V.get(`/registrations/sales-groups/grid/${u.customer.salesGroup[0].groupId}`);return c},enabled:!!u.customer});return o.useEffect(()=>{s&&d.invalidateQueries({queryKey:["sales-group-tree-data"]})},[s]),e.jsxs(K,{open:s,onOpenChange:m,children:[e.jsx(ie,{asChild:!0,children:e.jsxs(T,{variant:"outline",size:"sm",type:"button",onClick:()=>m(!0),disabled:u.customerId<=0,children:[e.jsx(fs,{className:"size-4"}),"Produtos do Canal de Venda"]})}),e.jsxs(Y,{className:"min-w-fit",children:[e.jsxs(J,{children:[e.jsx(X,{children:"Produtos do seu Canal de Venda"}),e.jsx(Z,{children:"Produtos relacionados ao seu Canal de Venda"})]}),e.jsx("div",{className:"flex flex-col space-y-6 mt-2",children:e.jsx(Cs,{data:r??[],className:"shadow-sm",searchable:!0,searchPlaceholder:"Buscar...",showSelectAllButtons:!1,isReadOnly:!0})}),e.jsx(ee,{children:e.jsx(T,{onClick:()=>m(!1),children:"Fechar"})})]})]})},Us=({data:s,onRefreshCalc:m,onValueChange:u})=>{const[d,r]=o.useState(!1),[c,x]=o.useState(s.length>0?s[0].carrierId.toString():""),f=n=>{const y=s.find(w=>w.carrierId==Number(n));u(Number(n),y?.freightValue??0,y?.deliveryDays??0),x(n)};return o.useEffect(()=>{s.findIndex(y=>y.name.includes("(Frete Grátis)"))>=0&&r(!0)},[s]),!s||s.length==0?e.jsxs("div",{className:"bg-red-200 rounded-md flex items-center justify-center flex-col space-y-2 p-2 mb-2",children:[e.jsx("p",{className:"text-sm font-semibold",children:"Algo deu errado ao conectar ao TOTVS para calculo dos Fretes."}),e.jsx(T,{onClick:()=>{m()},children:"Clique aqui para tentar novamente"})]}):e.jsxs("div",{children:[e.jsx(ws,{defaultValue:c,onValueChange:n=>{f(n)},children:e.jsxs(he,{children:[e.jsx(pe,{children:e.jsxs(L,{children:[e.jsx(I,{}),e.jsx(I,{className:"w-[100px]",children:"Transportadora"}),e.jsx(I,{children:"Prazo (dias)"}),e.jsx(I,{children:"Valor R$"})]})}),e.jsx(fe,{children:s.map(n=>e.jsxs(L,{className:c==n.carrierId.toString()?"bg-blue-100":"",children:[e.jsx(O,{children:e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx(Ps,{value:n.carrierId.toString(),id:n.carrierId.toString()})})}),e.jsx(O,{className:"font-medium",children:n.name}),e.jsx(O,{children:C(n.deliveryDays,0)}),e.jsx(O,{className:"text-right",children:C(n.freightValue,2)})]},n.carrierId))})]})}),e.jsxs("ul",{className:"text-[10px] border-t py-1",children:[d&&e.jsxs("li",{children:[e.jsx("b",{children:"FRETE GRÁTIS: "})," Nesta condição, poderá ocorrer a alteração de Transportadora sem aviso prévio, mas sem custos adicionais."]}),e.jsxs("li",{children:[e.jsx("b",{children:"RETIRA: "})," Após a emissão da nota fiscal, os produtos estarão disponíveis para retirada nos horários das 09h00 às 10h00 e das 15h00 às 16h00."]})]})]})},Qs=({value:s,onChange:m,placeholder:u,mask:d,disabled:r,readOnly:c})=>{const x=o.useRef(null),f=o.useRef(null);return o.useEffect(()=>(x.current&&(f.current=Ts(x.current,{mask:d}),f.current.on("accept",()=>{m?.(f.current.value)})),()=>{f.current&&f.current.destroy()}),[m]),o.useEffect(()=>{f.current&&s!==f.current.value&&(f.current.value=s||"")},[s]),e.jsx(W,{readOnly:c,disabled:r,ref:x,defaultValue:s,placeholder:u})},Gs=({data:s})=>{const[m,u]=o.useState(!1);return e.jsxs(K,{open:m,onOpenChange:u,children:[e.jsx(ie,{asChild:!0,children:e.jsx("button",{type:"button",className:"mr-2 rounded-full bg-yellow-400 p-0 size-5 text-[15px] flex items-center justify-center",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",height:"10px",width:"10px",version:"1.1",id:"Capa_1",viewBox:"0 0 32 32",children:e.jsx("g",{children:e.jsx("g",{id:"info",children:e.jsxs("g",{children:[e.jsx("path",{style:{fill:"#030104"},d:"M10,16c1.105,0,2,0.895,2,2v8c0,1.105-0.895,2-2,2H8v4h16v-4h-1.992c-1.102,0-2-0.895-2-2L20,12H8     v4H10z"}),e.jsx("circle",{style:{fill:"#030104"},cx:"16",cy:"4",r:"4"})]})})})})})}),e.jsxs(Y,{children:[e.jsxs(J,{children:[e.jsx(X,{children:"Impostos Calculados"}),e.jsx(Z,{})]}),e.jsxs("div",{className:"flex flex-col border",children:[e.jsxs("div",{className:"grid grid-cols-4 text-sm border-b bg-neutral-200 border-neutral-300",children:[e.jsx("div",{className:"border-r border-neutral-300 px-1",children:"Imposto"}),e.jsx("div",{className:"border-r border-neutral-300 px-1",children:"Valor"}),e.jsx("div",{className:"border-r border-neutral-300 px-1",children:"Base de Cálculo"}),e.jsx("div",{className:"px-1",children:"Alíquota"})]}),s?.TaxesDetail.map(d=>e.jsxs("div",{className:"grid grid-cols-4 border-b py-1.5 px-1 last:border-b-0 first:border-t text-sm even:bg-neutral-50",children:[e.jsx("div",{children:d.descricao}),e.jsx("div",{children:C(d.valor,2)}),e.jsx("div",{children:C(d.base_calculo,2)}),e.jsx("div",{children:C(d.aliquota,2)})]},d.descricao))]}),e.jsx(ee,{children:e.jsx(T,{onClick:()=>u(!1),children:"Fechar"})})]})]})},Ws=({isOpen:s,onClose:m})=>{const u=Oe(),{session:d}=Ve(),{order:r,mode:c,setOrder:x}=F(),{showAppDialog:f}=te(),n=c=="NEW"||c=="EDIT",[y,w]=o.useState(!1),[D,a]=o.useState(""),[v,l]=o.useState([]),[N,k]=o.useState([]),[B,R]=o.useState([]),[p,b]=o.useState(),[P,U]=o.useState(void 0),[j,A]=o.useState(!1),[ne,je]=o.useState(!1),[Be,ge]=o.useState(!1),[be,ve]=o.useState(0);async function Ne(){let t="";const h={...r,history:[]};if(w(!0),h.items.map(i=>i.taxes=[]),h.items.map(i=>{i.taxes=[],p?.itens.map(g=>{g.produto.codigo_produto==i.productId&&(i.taxes.push({id:q(),itemId:i.id,orderId:i.orderId,taxBase:g.produto.base_calculo_cofins,taxBaseReduction:0,taxName:"COFINS",taxPercentual:g.produto.aliquota_cofins,taxValue:g.produto.valor_cofins}),i.taxes.push({id:q(),itemId:i.id,orderId:i.orderId,taxBase:g.produto.base_calculo_pis,taxBaseReduction:0,taxName:"PIS",taxPercentual:g.produto.aliquota_pis,taxValue:g.produto.valor_pis}),i.taxes.push({id:q(),itemId:i.id,orderId:i.orderId,taxBase:g.produto.base_calculo_ipi,taxBaseReduction:0,taxName:"IPI",taxPercentual:g.produto.aliquota_ipi,taxValue:g.produto.valor_ipi}),i.taxes.push({id:q(),itemId:i.id,orderId:i.orderId,taxBase:0,taxBaseReduction:0,taxName:"CSLL",taxPercentual:g.produto.aliquota_csll,taxValue:g.produto.valor_csll}),i.taxes.push({id:q(),itemId:i.id,orderId:i.orderId,taxBase:g.produto.base_calculo_icms,taxBaseReduction:0,taxName:"ICMS",taxPercentual:g.produto.aliquota_icms,taxValue:g.produto.valor_icms}),i.taxes.push({id:q(),itemId:i.id,orderId:i.orderId,taxBase:g.produto.base_calculo_st,taxBaseReduction:0,taxName:"ICMS-ST",taxPercentual:g.produto.aliquota_st,taxValue:g.produto.valor_st}),g.produto.reforma.map($=>{i.taxes.push({id:q(),itemId:i.id,orderId:i.orderId,taxBase:$.base_tributo,taxBaseReduction:$.perc_reducao_governamental,taxName:$.tipo_tributo_descricao,taxPercentual:$.aliquota,taxValue:$.valor_tributo})}))})}),r.id){const{data:i}=await V.patch("/orders",h);t=i.orderId}else{const{data:i}=await V.post("/orders",h);t=i.orderId}h.maxBillingDate&&await f({title:"ATENÇÃO",message:"Você informou uma Data Mínima de Faturamento. Favor entrar em contato com a THULE pelo e-mail <b>pedidos.itupeva@thule.com<b/> e solicitar a alocação do estoque para este Pedido.",type:"info"}),w(!1),m(),await f({type:"success",title:r.isBudget?"Simulação Enviada com Sucesso":"Pedido Enviado com sucesso!",message:r.isBudget?`Gerada a Simulação ${t}`:`Gerado o Pedido ${t}`,buttons:[{text:"OK",variant:"primary",value:"ok",autoClose:!0}]}),r.isBudget?u({to:"/budgets"}):u({to:"/orders"})}const Re=()=>r.items.reduce((t,h)=>t+=h.orderQuantity*h.inputPrice,0),le=()=>{let t=r.items.reduce((h,i)=>h+=i.orderQuantity*i.inputPrice,0);return r.additionalDiscount>0&&(t=Ce(t-t*(r?.additionalDiscount??0)/100,2)),t=Ce(t-t*(r?.discountPercentual??0)/100+(r?.freightValue??0),2),t+be},Ae=()=>{if(!r.customer)return;const t=r.customer.deliveryLocations.filter(i=>i.id==r.deliveryLocationId);return t?[se(t,"id",i=>`${i.id} - ${i.address} - ${i.city} - ${i.state}`)[0]]:void 0},$e=async()=>{const{data:t}=await V.get("/registrations/payment-conditions/all?onlyActives=true"),h=t.map(i=>({value:i.id.toString(),label:`${i.id} - ${i.name}`,extra:i}));l(h),U(r.paymentCondition)},_e=()=>{const t=v.find(h=>h.value==r.paymentConditionId.toString());if(t)return[t]},qe=async()=>{const t=await Ge(d?.user.id??"");k(t??[])},M=t=>{if(d?.user.role==0)return!1;const h=N.find(i=>i.permissionId==t);return h?!h.isPermitted:!0},ye=t=>{if(t<0){E.warning("Percentual Inválido!");return}if(t>100){E.warning("Percentual Inválido!");return}r.discountPercentual=t,x({...r})},oe=async()=>{if(n){A(!0),ge(!1);try{R([]);const t=[{customerAbbreviation:r.customer?.abbreviation??"",deliveryLocationId:r.customer?.deliveryLocations[0].id??"",orderId:r.id??"",totalOrder:le()}],h=r.items.map(g=>({productId:g.productId,quantity:g.orderQuantity,sequence:g.sequence})),{data:i}=await V.post("/orders/calculate-freights",{ttParam:t,ttItems:h});if(i&&i.length>0){const g=i.sort(($,de)=>$.carrierId===0&&de.carrierId!==0?1:$.carrierId!==0&&de.carrierId===0?-1:$.freightValue-de.freightValue);r.freightValue=r.freightPaymentId==1?0:g[0].freightValue,R(g),x({...r,freightValue:g[0].freightValue,carrierId:g[0].carrierId})}}catch(t){ge(!0),console.log(t),E.error(We(t))}finally{A(!1)}}},ze=async()=>{je(!0);try{if(!n||r.items.length==0)return;const t={BranchId:r.branchId,SalesType:"N",CustomerId:String(r.customerId),CustomerUnit:"",CustomerIdDelivery:String(r.customerId),CustomerUnitDelivery:"",Currency:0,Payment:String(r.paymentConditionId),Freight:r.freightValue,ListofProducts:r.items.map(i=>({ItemId:`${i.sequence+10}`,ProductId:i.productId,CodRefer:i.referenceCode,Quantity:i.orderQuantity,UnitaryValue:i.inputPrice*(1-r.discountPercentual/100),TotalValue:i.inputPrice*i.orderQuantity,TES:r.customer?.fiscalOperationId??"",ItemDiscountPercentage:0,PriceTableId:i.priceTableId}))},{data:h}=await V.post("/order-items/calc-item-taxes",t);h?(b(h),ve(h.total_impostos)):ve(0)}catch(t){console.log(t)}finally{je(!1)}},Me=t=>{const h={...r},i=v.find(g=>g.value==t);i&&(h.paymentConditionId=Number(t),i&&i.extra?.additionalDiscountPercent>0&&(h.additionalDiscount=i.extra.additionalDiscountPercent),x(h),U(i.extra))};return o.useEffect(()=>{s&&($e(),qe(),oe())},[s]),o.useEffect(()=>{a("");const t=le();P&&P.minOrderValue>0&&t<P.minOrderValue&&a(`Para comprar com a condição de pagamento selecionada, seu pedido deve ser de no mínimo R$ ${C(P.minOrderValue,2)}`),r.customer&&r.customer.minValuePayedFreight>0&&r.freightPaymentId==1&&t<r.customer.minValuePayedFreight},[P,r.grossTotalValue]),o.useEffect(()=>{ze()},[r]),e.jsx(K,{open:s,onOpenChange:m,children:e.jsxs(Y,{className:"min-w-[70%]",children:[e.jsxs(J,{children:[e.jsxs(X,{children:[n?"Finalizar ":"Resumo de "," ",r.isBudget?"Simulação":"Pedido"]}),e.jsx(Z,{})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-x-4",children:[e.jsxs("div",{className:"flex flex-col space-y-4 mt-2",children:[e.jsxs("div",{className:"grid grid-cols-2 space-x-4",children:[e.jsxs("div",{className:"form-group",children:[e.jsx(S,{children:r.isBudget?"Tipo da Simulação":"Tipo do Pedido"}),e.jsxs(Ie,{defaultValue:r.orderClassificationId.toString(),disabled:!n||M("317")||r.orderClassificationId==6,children:[e.jsx(we,{className:"w-full bg-white",children:e.jsx(Pe,{placeholder:"Selecione uma opção"})}),e.jsxs(Se,{children:[e.jsx(_,{value:"1",children:"Venda"}),e.jsx(_,{value:"2",children:"Venda Cliente Final"}),e.jsx(_,{value:"3",children:"Bonificação"}),e.jsx(_,{value:"4",children:"Remessa Consignação"}),e.jsx(_,{value:"5",children:"Garantia"}),e.jsx(_,{value:"6",disabled:!0,children:"Outlet"})]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx(S,{children:"Nº Pedido Distribuidor"}),e.jsx(W,{disabled:!n})]})]}),e.jsx("div",{children:e.jsxs("div",{className:"form-group",children:[e.jsx(S,{children:"Nº Whatsapp"}),e.jsx(Qs,{value:r.whatAppPhoneNumber,onChange:t=>{r.whatAppPhoneNumber=t??"",x(r)},disabled:!n,mask:"(00) 00000-0000"})]})}),e.jsxs("div",{className:"form-group",children:[e.jsx(S,{children:"Endereço de Entrega"}),e.jsx(H,{disabled:!n||M("308"),placeholder:"Selecione o Endereço de Entrega",staticItems:se(r.customer?.deliveryLocations??[],"id",t=>`${t.id} - ${t.address} - ${t.city} - ${t.state}`),defaultValue:Ae()})]}),e.jsxs("div",{className:"form-group",children:[e.jsx(S,{children:"Condição de Pagamento"}),!n&&e.jsx(W,{readOnly:!0,value:`${r.paymentConditionId} - ${r.paymentCondition?.name}`}),n&&e.jsx(H,{placeholder:"Selecione a Condição de Pagamento",staticItems:v,defaultValue:_e(),onChange:t=>{Me(t)}})]}),e.jsxs("div",{className:"form-group",children:[e.jsx(S,{children:"Estabelecimento"}),e.jsxs("div",{className:"flex items-center gap-x-2",children:[e.jsxs(Ie,{defaultValue:r.branchId,disabled:!n||M("309"),children:[e.jsx(we,{className:"w-full bg-white",children:e.jsx(Pe,{placeholder:"Selecione uma opção"})}),e.jsxs(Se,{children:[e.jsx(_,{value:"1",children:"1"}),e.jsx(_,{value:"10",children:"10"}),e.jsx(_,{value:"11",children:"11"})]})]}),e.jsxs(S,{children:[e.jsx(Q,{disabled:!n}),"Importadora"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-x-4 ",children:[e.jsxs("div",{className:"form-group",children:[e.jsx(S,{children:"Faturar em"}),e.jsx(Te,{disabled:!n||M("312")})]}),e.jsxs("div",{className:"form-group",children:[e.jsx(S,{children:"Faturar no Máximo até"}),e.jsx(Te,{disabled:!n||M("312")})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-x-4 space-y-2",children:[e.jsx("div",{className:"form-group",children:e.jsxs(S,{children:[e.jsx(Q,{disabled:!n||r.orderClassificationId==6,checked:r.isParcialBilling,onCheckedChange:t=>{const h={...r,isParcialBilling:!!t};x(h)}}),"Fatura Parcial"]})}),e.jsx("div",{className:"form-group",children:e.jsxs(S,{children:[e.jsx(Q,{disabled:!n||M("314")||r.orderClassificationId==6,checked:r.freightPaymentId==3,onCheckedChange:t=>{const h={...r,freightPaymentId:t?3:1};x(h)}}),"Frete Pago"]})}),e.jsx("div",{className:"form-group",children:e.jsxs(S,{children:[e.jsx(Q,{disabled:!n||M("315"),checked:r.useCustomerCarrier,onCheckedChange:t=>{console.log("aki");const h={...r,useCustomerCarrier:!!t};t==!0&&(h.freightValue=0,h.freightTypeId=4,h.carrierId=h.customer?.carrierId??0),x(h),t||setTimeout(()=>{oe()},1e3)}}),"Usa Transportadora do Cliente"]})}),e.jsx("div",{className:"form-group",children:e.jsxs(S,{children:[e.jsx(Q,{disabled:!n}),"Enviar Display com o Pedido"]})})]})]}),e.jsxs("div",{className:"border-l px-4",children:[!n&&e.jsxs("div",{className:"mb-2 form-group",children:[e.jsx(S,{children:"Transportadora"}),e.jsx(W,{readOnly:!0,value:`${r.carrier?.id} - ${r.carrier?.abbreviation}`})]}),n&&e.jsxs(e.Fragment,{children:[" ",e.jsx("h3",{className:"font-semibold text-xl",children:"Selecione uma opção de Frete"}),e.jsxs("div",{children:[j&&e.jsxs("div",{className:"flex items-center justify-center h-[100px] border",children:[e.jsx(ce,{className:"animate-spin mr-1.5 text-blue-600"}),e.jsx("span",{children:"Caculando Frete. Aguarde..."})]}),!j&&e.jsx(Us,{data:B,onRefreshCalc:()=>oe(),onValueChange:(t,h)=>{r.carrierId=t,r.freightValue=h,x({...r})}})]})]}),e.jsxs("div",{className:"bg-neutral-100 px-4 rounded-md py-2 space-y-2",children:[e.jsxs("div",{className:"flex justify-between pr-2",children:[e.jsxs("span",{children:["Sub-Total ",r.isBudget?"da Simulação":"do Pedido",":"]}),e.jsxs("span",{children:["R$ ",C(Re(),2)]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx(S,{children:"% Desconto:"}),e.jsxs("div",{className:"flex gap-x-1.5 items-center",children:[e.jsx(Ss,{thousandSeparator:".",decimalSeparator:",",decimalScale:2,fixedDecimalScale:!0,disabled:!0,max:100,min:0,maxLength:6,value:r.discountPercentual??0,className:z("file:text-foreground text-right placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-8 w-[90px] min-w-0 rounded-md border bg-white px-3 py-1 text-sm shadow-xs transition-[color,box-shadow] outline-none disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-100 disabled:border-none disabled:shadow-none","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","read-only:bg-neutral-100","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive"),onValueChange:t=>ye(t.floatValue??0)}),n&&r.orderClassificationId!=6&&e.jsx(G,{message:"Desfazer",children:e.jsx("button",{className:"hover:bg-neutral-200 bg-neutral-50 p-1 rounded border border-neutral-300",onClick:()=>{ye(r.customer?.discountPercent??0)},children:e.jsx(js,{className:"size-4"})})})]})]}),((r.orderClassificationId!=6&&P?.additionalDiscountPercent)??!1)&&e.jsxs("div",{className:"flex justify-between text-sm bg-orange-100 p-1 rounded",children:[e.jsx(S,{className:"text-orange-600",children:"% Desconto Adicional:"}),e.jsxs("div",{className:"flex gap-x-1.5 items-center",children:[e.jsxs("span",{children:[C(r.additionalDiscount,2),"%"]}),e.jsx(Q,{defaultChecked:(P?.additionalDiscountPercent??0)>0,onCheckedChange:t=>{t?r.additionalDiscount=P?.additionalDiscountPercent??0:r.additionalDiscount=0,x({...r})}})]})]}),e.jsxs("div",{className:"flex justify-between pr-2 text-sm",children:[e.jsx("span",{children:"Frete:"}),e.jsxs("span",{children:["R$ ",C(r.freightValue,2)]})]}),e.jsxs("div",{className:"flex justify-between pr-2 text-sm",children:[e.jsxs("div",{className:"flex",children:[e.jsx(Gs,{data:p}),"Impostos:"]}),ne&&e.jsxs("div",{className:"text-xs min-w-fit flex items-center",children:[e.jsx(gs,{className:"size-3 animate-spin mr-1"}),"Calculando..."]}),!ne&&e.jsxs("span",{children:["R$ ",C(be,2)]})]}),e.jsxs("div",{className:"flex justify-between font-medium pr-2 bg-emerald-600 rounded-md py-2 px-2 text-white",children:[e.jsxs("span",{children:[r.isBudget?"Total da Simulação":"Total do Pedido"," "]}),e.jsxs("span",{children:["R$ ",C(le(),2)]})]}),D&&e.jsx("div",{className:"flex items-center justify-center font-medium bg-red-200 text-whit p-2",children:D})]})]})]}),e.jsxs(ee,{children:[e.jsx(T,{variant:"secondary",onClick:()=>m(),children:"Voltar"}),r.isBudget&&n&&e.jsx(T,{disabled:j||Be,variant:"green",onClick:Ne,className:"text-emerald-900",children:y?e.jsx("div",{children:e.jsx(ce,{className:"size-4"})}):"Gravar Simulação"}),n&&e.jsx(T,{onClick:Ne,disabled:j||ne||y,children:y?e.jsx("div",{children:e.jsx(ce,{className:"size-4"})}):e.jsxs("span",{children:[r.isBudget?"Gerar":"Enviar"," Pedido"]})})]})]})})},Hs=()=>{const{order:s}=F(),m=async()=>{const d=await V.get(`/orders/xlsx/${s.id}`,{responseType:"blob"}),r=new Blob([d.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),c=window.URL.createObjectURL(r),x=document.createElement("a");x.href=c,x.setAttribute("download",`${s.orderId}.xlsx`),document.body.appendChild(x),x.click(),x.parentNode?.removeChild(x),window.URL.revokeObjectURL(c)},u=async()=>{const d=await V.get(`/orders/pdf/${s.id}`,{responseType:"blob"}),r=new Blob([d.data],{type:"application/pdf"}),c=window.URL.createObjectURL(r);window.open(c)};return e.jsxs(Ds,{children:[e.jsx(ks,{asChild:!0,children:e.jsxs(T,{variant:"outline",size:"sm",children:["Exportar ",e.jsx(Es,{className:"size-4"})]})}),e.jsxs(Os,{children:[e.jsx(De,{onClick:()=>m(),children:"Excel"}),e.jsx(Vs,{}),e.jsx(De,{onClick:()=>u(),children:"PDF"})]})]})},Br=()=>{const s=Oe(),[m,u]=o.useState(!1),{order:d,mode:r,isBudget:c}=F(),x=r=="NEW"||r=="EDIT";return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col space-y-2 relative overflow-hidden container ml-auto mr-auto border",style:{height:"calc(100vh - 110px"},children:[e.jsx(zs,{}),e.jsx(qs,{}),e.jsxs("div",{className:"absolute bottom-0 right-0 left-0 bg-neutral-100 border-t px-2 py-2 flex items-center justify-between",children:[e.jsxs("div",{className:"flex gap-x-2",children:[e.jsx(Ms,{}),e.jsx(Ls,{}),!x&&e.jsx(Hs,{})]}),e.jsxs("div",{className:"flex items-center justify-center gap-x-2",children:[e.jsxs(T,{variant:"outline",size:"sm",onClick:()=>s({to:"/orders"}),children:[x,"Cancelar"]}),e.jsx(T,{disabled:d.items.length==0,size:"sm",type:"button",onClick:()=>u(!0),children:x?`Concluir ${c?"Simulação":"Pedido"}`:"Ver Resumo"})]})]})]}),m&&e.jsx(Ws,{isOpen:m,onClose:()=>u(!1)})]})};export{Fr as O,Br as a};
