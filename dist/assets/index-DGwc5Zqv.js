import{S as f,x as b,y as h,z as y,B as p,i as v,r as o,D as j,E as M,j as s,P as I,t as C,e as S}from"./index-C-yn2kxu.js";import{A as D}from"./app-page-header-B97b6w1v.js";import{S as O}from"./server-table-OrazAZj6.js";import{P as k}from"./product-image-870267Xw.js";import{B as c}from"./index-Cj-kxx9Z.js";import{D as F,a as P,b as w,c as m}from"./dropdown-menu-3YsRMfS2.js";import{M as E}from"./menu-DLE56LUh.js";import{D as T,a as N,b as z,c as R,d as U,f as A}from"./dialog-o4W0LXdK.js";import{T as K}from"./textarea-Ce4OrkIc.js";import"./input-Dr2m_CVc.js";import"./app-tooltip-1VY1K540.js";import"./index-D5w6tM8m.js";import"./Combination-BJv6NSEb.js";import"./index-z0-V-lU6.js";import"./index-BoUYBFaC.js";import"./index-DRosYylb.js";import"./select-BqrgrOas.js";import"./index-Cap87g99.js";import"./chevron-down-lpqsW9lE.js";import"./index-Dtymrjkl.js";import"./search-8CyYJVSP.js";import"./funnel-CSCaqyL5.js";import"./loader-circle-BV1pYLGQ.js";import"./chevron-left-DklgzkMt.js";import"./chevron-right-CCWYEIpL.js";import"./index-C8Qjzrxd.js";var q=class extends f{#s;#i=void 0;#e;#t;constructor(e,i){super(),this.#s=e,this.setOptions(i),this.bindMethods(),this.#r()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){const i=this.options;this.options=this.#s.defaultMutationOptions(e),b(this.options,i)||this.#s.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#e,observer:this}),i?.mutationKey&&this.options.mutationKey&&h(i.mutationKey)!==h(this.options.mutationKey)?this.reset():this.#e?.state.status==="pending"&&this.#e.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#e?.removeObserver(this)}onMutationUpdate(e){this.#r(),this.#a(e)}getCurrentResult(){return this.#i}reset(){this.#e?.removeObserver(this),this.#e=void 0,this.#r(),this.#a()}mutate(e,i){return this.#t=i,this.#e?.removeObserver(this),this.#e=this.#s.getMutationCache().build(this.#s,this.options),this.#e.addObserver(this),this.#e.execute(e)}#r(){const e=this.#e?.state??y();this.#i={...e,isPending:e.status==="pending",isSuccess:e.status==="success",isError:e.status==="error",isIdle:e.status==="idle",mutate:this.mutate,reset:this.reset}}#a(e){p.batch(()=>{if(this.#t&&this.hasListeners()){const i=this.#i.variables,t=this.#i.context;e?.type==="success"?(this.#t.onSuccess?.(e.data,i,t),this.#t.onSettled?.(e.data,null,i,t)):e?.type==="error"&&(this.#t.onError?.(e.error,i,t),this.#t.onSettled?.(void 0,e.error,i,t))}this.listeners.forEach(i=>{i(this.#i)})})}};function B(e,i){const t=v(),[r]=o.useState(()=>new q(t,e));o.useEffect(()=>{r.setOptions(e)},[r,e]);const a=o.useSyncExternalStore(o.useCallback(n=>r.subscribe(p.batchCalls(n)),[r]),()=>r.getCurrentResult(),()=>r.getCurrentResult()),d=o.useCallback((n,l)=>{r.mutate(n,l).catch(j)},[r]);if(a.error&&M(r.options.throwOnError,[a.error]))throw a.error;return{...a,mutate:d,mutateAsync:a.mutate}}const G=({fnDetails:e,fnMessage:i})=>[{key:"imageUrl",dataIndex:"imageUrl",title:"Foto",renderItem:t=>s.jsx(k,{alt:t.id,productId:t.id,className:"!size-24"}),sortable:!0},{key:"id",dataIndex:"id",title:"Código",renderItem:t=>s.jsx("span",{className:"font-semibold text-blue-600 ",children:t.id}),sortable:!0},{key:"description",dataIndex:"description",title:"Descrição",renderItem:t=>s.jsx("span",{children:t.description}),sortable:!0},{key:"referenceCode",dataIndex:"referenceCode",title:"Código Curto",sortable:!0},{key:"commercialFamilyId",dataIndex:"commercialFamilyId",title:"Família Comercial",renderItem:t=>s.jsx("span",{children:t.commercialFamilyId}),sortable:!0},{key:"groupId",dataIndex:"groupId",title:"Grupo de Estoque",renderItem:t=>s.jsx("span",{children:t.productGroup?.name}),sortable:!0},{key:"productFamilyId",dataIndex:"productFamilyId",title:"Família",renderItem:t=>s.jsx("span",{children:t.familyId}),sortable:!0},{key:"orderMessage",dataIndex:"orderMessage",title:"Mensagem Ped/Simul."},{key:"actions",dataIndex:"id",title:"Ações",renderItem:t=>s.jsx("div",{className:"flex justify-end",children:s.jsxs(F,{children:[s.jsx(P,{asChild:!0,children:s.jsx(c,{size:"sm",variant:"secondary",children:s.jsx(E,{className:"size-4"})})}),s.jsxs(w,{align:"end",className:"",children:[s.jsx(m,{onClick:()=>e(t),children:"Fotos"}),s.jsx(m,{onClick:()=>i(t),children:"Mensagem p/Pedidos e Simulações"})]})]})})}],L=({isOpen:e,initialData:i,onClose:t})=>{const[r,a]=o.useState(i.orderMessage??""),{mutate:d}=B({mutationFn:()=>I.update({...i,orderMessage:r??""}),onSuccess:()=>{C.success("Mensagem atualizada!"),t(!0)}}),n=()=>{d()};return s.jsx(T,{open:e,onOpenChange:()=>t(!1),children:s.jsxs(N,{children:[s.jsxs(z,{children:[s.jsx(R,{children:"Mensagem para Pedidos/Simulações"}),s.jsx(U,{children:"Esta mensagem será exibida no momento que o usuário adicionar este produto a um pedido ou simulação."})]}),s.jsx("div",{children:s.jsx(K,{value:r,onChange:l=>a(l.target.value)})}),s.jsxs(A,{children:[s.jsx(c,{onClick:()=>n(),children:"Gravar"}),s.jsx(c,{variant:"secondary",size:"sm",onClick:()=>t(!1),children:"Fechar"})]})]})})},H=[{id:"id",label:"Código"},{id:"description",label:"Descrição"}],fe=function(){const i=S(),[t,r]=o.useState(!1),[a,d]=o.useState(null),[n,l]=o.useState(new Date().valueOf()),g=async u=>{i({to:`/registrations/products/${u.id}`})},x=async u=>{d(u),r(!0)};return s.jsxs(D,{titleSlot:"Produtos",children:[s.jsx("div",{className:"p-2",children:s.jsx(O,{defaultSearchField:"id",defaultSortFieldDataIndex:"id",searchFields:H,columns:G({fnDetails:g,fnMessage:x}),showAddButton:!1,dataUrl:"/registrations/products/list-paged"},n)}),t&&a&&s.jsx(L,{isOpen:t,initialData:a,onClose:u=>{r(!1),d(null),u&&l(new Date().valueOf())}})]})};export{fe as component};
