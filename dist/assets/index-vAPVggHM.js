import{j as e,r,g as l,t as j,h as T,ac as I,e as y}from"./index-C-yn2kxu.js";import{A as D}from"./app-page-header-B97b6w1v.js";import{S}from"./server-table-OrazAZj6.js";import{B as n}from"./index-Cj-kxx9Z.js";import{u as w}from"./useQuery-BEMaX6S8.js";import{B as P,S as k,c as A}from"./search-combo-DoY-PKU3.js";import{T as E}from"./trash-DuwzUJ5T.js";import{C as $}from"./select-BqrgrOas.js";import{C as N}from"./chevron-down-lpqsW9lE.js";import{C as O}from"./checkbox-BvWHDgRj.js";import{D as B,a as F,b as L,c as z,d as K,f as M}from"./dialog-o4W0LXdK.js";import{L as q}from"./label-PvIEZhsH.js";import"./input-Dr2m_CVc.js";import"./app-tooltip-1VY1K540.js";import"./index-D5w6tM8m.js";import"./Combination-BJv6NSEb.js";import"./index-z0-V-lU6.js";import"./index-BoUYBFaC.js";import"./index-DRosYylb.js";import"./index-Dtymrjkl.js";import"./search-8CyYJVSP.js";import"./funnel-CSCaqyL5.js";import"./loader-circle-BV1pYLGQ.js";import"./chevron-left-DklgzkMt.js";import"./chevron-right-CCWYEIpL.js";import"./command-DF-KUbv3.js";import"./index-C8Qjzrxd.js";import"./popover-D4FvDG7G.js";import"./chevrons-up-down-DXmsIWP1.js";import"./index-Cap87g99.js";import"./minus-Cc6YOJ9G.js";const H=({fnDelete:c,fnReorder:i})=>[{key:"priceTableId",dataIndex:"priceTableId",title:"Tabela de Preço"},{key:"isException",dataIndex:"isException",title:"Tabela de Excessão?",cellClassName:"text-center",renderItem:a=>a.isException?e.jsx(P,{variant:"destructive",children:"Sim"}):e.jsx("span",{})},{key:"actions",dataIndex:"priceTableId",title:"Ações",renderItem:a=>e.jsxs("div",{className:"flex gap-x-1",children:[e.jsx(n,{variant:"destructive",onClick:()=>c(a),children:e.jsx(E,{className:"size-4"})}),a.priceTableId!=="PrBase"&&e.jsxs(e.Fragment,{children:[" ",e.jsx(n,{variant:"secondary",onClick:()=>i(a,"up"),children:e.jsx($,{className:"size-4"})}),e.jsx(n,{variant:"secondary",onClick:()=>i(a,"down"),children:e.jsx(N,{className:"size-4"})})]})]})}],R=({isOpen:c,customerId:i,onClose:a})=>{const[d,m]=r.useState(""),[o,x]=r.useState(!1),[p,b]=r.useState([]),[h,f]=r.useState(new Date().valueOf()),[t,u]=r.useState(!1),v=async()=>{const s={customerId:i,priceTableId:d,isException:o};try{await l.post("/registrations/customer-price-tables",s),j.success("Tabela de Preço Vinculada"),a(!0)}catch(g){j.error(T(g))}},C=async()=>{u(!0);try{const{data:s}=await l.get("/registrations/price-tables/all"),g=A(s,"id","id",!1);b(g)}catch(s){j.error(T(s))}finally{u(!1)}};return r.useEffect(()=>{C(),f(new Date().valueOf())},[c]),e.jsx(B,{open:c,onOpenChange:a,children:e.jsxs(F,{children:[e.jsxs(L,{children:[e.jsx(z,{children:"Adicionar Tabela de Preço"}),e.jsx(K,{})]}),e.jsx("div",{children:e.jsx(k,{onChange:s=>m(s),staticItems:p,disabled:t},h)}),e.jsx("div",{children:e.jsxs(q,{children:[e.jsx(O,{onCheckedChange:s=>x(!!s)}),"Tabela de Excessão"]})}),e.jsxs(M,{children:[e.jsx(n,{variant:"green",onClick:()=>v(),children:"Adicionar"}),e.jsx(n,{variant:"secondary",onClick:()=>a(!1),children:"Cancelar"})]})]})})},ve=function(){const[i,a]=r.useState(new Date().valueOf()),[d,m]=r.useState(!1),{customerId:o}=I({from:"/_app/registrations/customers/$customerId/price-tables/"}),x=y(),{data:p}=w({queryKey:["customer-id",o],queryFn:async()=>{const{data:t}=await l.get(`/registrations/customers/id/${o}`);return t},enabled:!!o}),b=()=>{m(!0)},h=async t=>{await l.delete(`/registrations/customer-price-tables/${t.customerId}/${t.priceTableId}`),a(new Date().valueOf())},f=async(t,u)=>{await l.patch(`/registrations/customer-price-tables/reorder/${t.customerId}/${t.priceTableId}/${u}`),a(new Date().valueOf())};return e.jsxs(D,{titleSlot:`Tabelas de Preço do Cliente: ${o} - ${p?.abbreviation}`,children:[e.jsx("div",{className:"max-w-lg ml-auto mr-auto mt-2",children:e.jsx(S,{onAdd:()=>b(),columns:H({fnDelete:h,fnReorder:f}),defaultSearchField:"priceTableId",searchFields:[{id:"priceTableId",label:"Tabela de Preço"}],dataUrl:"/registrations/customer-price-tables/list-paged",additionalInfo:{customerId:o}},i)}),e.jsx("div",{className:"my-4 max-w-lg ml-auto mr-auto",children:e.jsx(n,{onClick:()=>x({to:"/registrations/customers"}),children:"Voltar p/Lista de Clientes"})}),d&&e.jsx(R,{isOpen:d,onClose:t=>{t&&a(new Date().valueOf()),m(!1)},customerId:p?.id??-1})]})};export{ve as component};
