import{j as e,R as h,r as v,g as $,t as P,h as ge,e as ve,l as Ae}from"./index-C-yn2kxu.js";import{A as Ce}from"./app-page-header-B97b6w1v.js";import{S as je}from"./server-table-OrazAZj6.js";import{c as k,B as A,P as Q,u as Pe}from"./index-Cj-kxx9Z.js";import{D as Ie,a as Se,b as we,c as H,d as ye}from"./dropdown-menu-3YsRMfS2.js";import{S as Ne}from"./square-pen-C5Wms97H.js";import{T as ke}from"./trash-DuwzUJ5T.js";import{E as Ee,S as De,L as Re,c as W,R as _e,T as Te,b as Me}from"./index-CZe0kw5k.js";import{U as X}from"./users.service-CergIy0E.js";import{D as Z,a as ee,b as se,c as oe,d as ae,f as re}from"./dialog-o4W0LXdK.js";import{c as Le,b as te,a as Oe}from"./index-D5w6tM8m.js";import{e as Ue,u as Fe}from"./select-BqrgrOas.js";import{a as ze}from"./Combination-BJv6NSEb.js";import{C as Ge}from"./chevron-down-lpqsW9lE.js";import{C as I}from"./checkbox-BvWHDgRj.js";import{L as C}from"./label-PvIEZhsH.js";import{I as K}from"./input-Dr2m_CVc.js";import"./app-tooltip-1VY1K540.js";import"./index-z0-V-lU6.js";import"./index-BoUYBFaC.js";import"./index-DRosYylb.js";import"./index-Dtymrjkl.js";import"./search-8CyYJVSP.js";import"./funnel-CSCaqyL5.js";import"./loader-circle-BV1pYLGQ.js";import"./chevron-left-DklgzkMt.js";import"./chevron-right-CCWYEIpL.js";import"./index-C8Qjzrxd.js";import"./index-Cap87g99.js";import"./minus-Cc6YOJ9G.js";const Ve=({fnEdit:o,fnDelete:d,fnPermissions:a,fnChangePassword:r})=>[{title:"Código",dataIndex:"id",key:"id",sortable:!0,renderItem:n=>e.jsx("span",{className:"text-blue-600 font-semibold",children:n.id})},{title:"Nome",dataIndex:"name",key:"name",sortable:!0},{title:"E-mail",dataIndex:"email",key:"email",sortable:!0},{title:"Grupo",dataIndex:"groupId",key:"groupId",sortable:!0},{title:"Ativo",dataIndex:"isActive",key:"isActive",sortable:!1,renderItem:n=>e.jsx("span",{className:k(n.isActive?"bg-blue-600":"bg-red-400","text-white text-xs rounded-md p-1"),children:n.isActive?"Sim":"Não"})},{title:"Ações",dataIndex:"id",key:"actions",renderItem:n=>e.jsxs("div",{className:"flex flex-wrap gap-x-1 items-center",children:[e.jsx(A,{size:"sm",type:"button",onClick:()=>{o(n)},children:e.jsx(Ne,{className:"size-4"})}),e.jsx(A,{size:"sm",type:"button",variant:"destructive",onClick:()=>{d(n)},children:e.jsx(ke,{className:"size-4"})}),e.jsxs(Ie,{children:[e.jsx(Se,{asChild:!0,children:e.jsx(A,{variant:"secondary",size:"sm",children:e.jsx(Ee,{className:"size-4"})})}),e.jsxs(we,{side:"bottom",align:"end",children:[e.jsxs(H,{disabled:n.role=="0",onClick:()=>{a(n)},children:[e.jsx(De,{className:"size-4"}),"Permissões do Usuário"]}),e.jsx(ye,{}),e.jsxs(H,{onClick:()=>{r(n)},children:[e.jsx(Re,{className:"size-4"}),"Alterar a Senha"]})]})]})]})}];var b="Accordion",$e=["Home","End","ArrowDown","ArrowUp","ArrowLeft","ArrowRight"],[z,He,Ke]=Ue(b),[E,Os]=Le(b,[Ke,W]),G=W(),ne=h.forwardRef((o,d)=>{const{type:a,...r}=o,n=r,i=r;return e.jsx(z.Provider,{scope:o.__scopeAccordion,children:a==="multiple"?e.jsx(Je,{...i,ref:d}):e.jsx(Ye,{...n,ref:d})})});ne.displayName=b;var[ie,Be]=E(b),[le,qe]=E(b,{collapsible:!1}),Ye=h.forwardRef((o,d)=>{const{value:a,defaultValue:r,onValueChange:n=()=>{},collapsible:i=!1,...c}=o,[p,u]=te({prop:a,defaultProp:r??"",onChange:n,caller:b});return e.jsx(ie,{scope:o.__scopeAccordion,value:h.useMemo(()=>p?[p]:[],[p]),onItemOpen:u,onItemClose:h.useCallback(()=>i&&u(""),[i,u]),children:e.jsx(le,{scope:o.__scopeAccordion,collapsible:i,children:e.jsx(de,{...c,ref:d})})})}),Je=h.forwardRef((o,d)=>{const{value:a,defaultValue:r,onValueChange:n=()=>{},...i}=o,[c,p]=te({prop:a,defaultProp:r??[],onChange:n,caller:b}),u=h.useCallback(s=>p((l=[])=>[...l,s]),[p]),t=h.useCallback(s=>p((l=[])=>l.filter(m=>m!==s)),[p]);return e.jsx(ie,{scope:o.__scopeAccordion,value:c,onItemOpen:u,onItemClose:t,children:e.jsx(le,{scope:o.__scopeAccordion,collapsible:!0,children:e.jsx(de,{...i,ref:d})})})}),[Qe,D]=E(b),de=h.forwardRef((o,d)=>{const{__scopeAccordion:a,disabled:r,dir:n,orientation:i="vertical",...c}=o,p=h.useRef(null),u=Pe(p,d),t=He(a),l=Fe(n)==="ltr",m=Oe(o.onKeyDown,x=>{if(!$e.includes(x.key))return;const R=x.target,j=t().filter(U=>!U.ref.current?.disabled),f=j.findIndex(U=>U.ref.current===R),_=j.length;if(f===-1)return;x.preventDefault();let g=f;const T=0,M=_-1,L=()=>{g=f+1,g>M&&(g=T)},O=()=>{g=f-1,g<T&&(g=M)};switch(x.key){case"Home":g=T;break;case"End":g=M;break;case"ArrowRight":i==="horizontal"&&(l?L():O());break;case"ArrowDown":i==="vertical"&&L();break;case"ArrowLeft":i==="horizontal"&&(l?O():L());break;case"ArrowUp":i==="vertical"&&O();break}const be=g%_;j[be].ref.current?.focus()});return e.jsx(Qe,{scope:a,disabled:r,direction:n,orientation:i,children:e.jsx(z.Slot,{scope:a,children:e.jsx(Q.div,{...c,"data-orientation":i,ref:u,onKeyDown:r?void 0:m})})})}),N="AccordionItem",[We,V]=E(N),ce=h.forwardRef((o,d)=>{const{__scopeAccordion:a,value:r,...n}=o,i=D(N,a),c=Be(N,a),p=G(a),u=ze(),t=r&&c.value.includes(r)||!1,s=i.disabled||o.disabled;return e.jsx(We,{scope:a,open:t,disabled:s,triggerId:u,children:e.jsx(_e,{"data-orientation":i.orientation,"data-state":fe(t),...p,...n,ref:d,disabled:s,open:t,onOpenChange:l=>{l?c.onItemOpen(r):c.onItemClose(r)}})})});ce.displayName=N;var me="AccordionHeader",pe=h.forwardRef((o,d)=>{const{__scopeAccordion:a,...r}=o,n=D(b,a),i=V(me,a);return e.jsx(Q.h3,{"data-orientation":n.orientation,"data-state":fe(i.open),"data-disabled":i.disabled?"":void 0,...r,ref:d})});pe.displayName=me;var F="AccordionTrigger",ue=h.forwardRef((o,d)=>{const{__scopeAccordion:a,...r}=o,n=D(b,a),i=V(F,a),c=qe(F,a),p=G(a);return e.jsx(z.ItemSlot,{scope:a,children:e.jsx(Te,{"aria-disabled":i.open&&!c.collapsible||void 0,"data-orientation":n.orientation,id:i.triggerId,...p,...r,ref:d})})});ue.displayName=F;var xe="AccordionContent",he=h.forwardRef((o,d)=>{const{__scopeAccordion:a,...r}=o,n=D(b,a),i=V(xe,a),c=G(a);return e.jsx(Me,{role:"region","aria-labelledby":i.triggerId,"data-orientation":n.orientation,...c,...r,ref:d,style:{"--radix-accordion-content-height":"var(--radix-collapsible-content-height)","--radix-accordion-content-width":"var(--radix-collapsible-content-width)",...o.style}})});he.displayName=xe;function fe(o){return o?"open":"closed"}var Xe=ne,Ze=ce,es=pe,ss=ue,os=he;function as({...o}){return e.jsx(Xe,{"data-slot":"accordion",...o})}function S({className:o,...d}){return e.jsx(Ze,{"data-slot":"accordion-item",className:k("border-b last:border-b-0",o),...d})}function w({className:o,children:d,...a}){return e.jsx(es,{className:"flex",children:e.jsxs(ss,{"data-slot":"accordion-trigger",className:k("focus-visible:border-ring focus-visible:ring-ring/50 flex flex-1 items-start justify-between gap-4 rounded-md py-4 px-2 text-left text-sm font-medium transition-all outline-none hover:bg-blue-200 focus-visible:ring-[3px] disabled:pointer-events-none disabled:opacity-50 [&[data-state=open]>svg]:rotate-180",o),...a,children:[d,e.jsx(Ge,{className:"text-muted-foreground pointer-events-none size-4 shrink-0 translate-y-0.5 transition-transform duration-200"})]})})}function y({className:o,children:d,...a}){return e.jsx(os,{"data-slot":"accordion-content",className:"data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down overflow-hidden text-sm",...a,children:e.jsx("div",{className:k("pt-0 pb-4",o),children:d})})}const B=[{id:"1",label:"Metas de Representantes"},{id:"2",label:"Condições de Pagamento"},{id:"3",label:"Tabelas de Preço por Cliente"},{id:"4",label:"Grupos de Venda"},{id:"5",label:"Avisos"},{id:"6",label:"Alçadas de Aprovação"},{id:"7",label:"Produtos"},{id:"8",label:"Clientes"},{id:"9",label:"Aprovações"},{id:"10",label:"Aprovações"},{id:"11",label:"Grupos de Usuário"},{id:"12",label:"Usuários"},{id:"13",label:"Configurações do Portal"},{id:"14",label:"Sincronização"}],q=[{id:"101",label:"Notificações"},{id:"102",label:"Comunicados"},{id:"103",label:"Links Úteis"}],Y=[{id:"201",label:"Lista de Clientes"},{id:"202",label:"Lista de Pedidos"},{id:"203",label:"Produtos Vendidos"},{id:"204",label:"Faturamento"},{id:"205",label:"Análise de Desempenho"},{id:"206",label:"Comissão"},{id:"207",label:"Títulos Financeiros"},{id:"208",label:"Itens sem Saldo"}],J=[{id:"301",label:"Alterar Pedido Aprovado"},{id:"302",label:"Reprovar Pedido Aprovado"},{id:"303",label:"Reintegrar Pedido com Erro"},{id:"304",label:"Confirmação de Pedidos"},{id:"305",label:"Alterar Preço"},{id:"307",label:"Alterar Condição de Pagamento"},{id:"308",label:"Alterar Local de Entrega"},{id:"309",label:"Alterar Estabelecimento"},{id:"310",label:"Alterar Moeda"},{id:"311",label:"Alterar Transportadora"},{id:"312",label:"Alterar Datas Mínima/Máxima de Faturamento"},{id:"313",label:"Alterar Pedido Faturado Parcial"},{id:"314",label:"Alterar Frete Pago"},{id:"315",label:"Alterar Usa Transportadora do Cliente"},{id:"316",label:"Alterar Tabela de Preço"},{id:"317",label:"Alterar Classificação do Pedido"}],rs=({user:o,isOpen:d,onClose:a})=>{const[r,n]=v.useState([]);v.useEffect(()=>{d&&i()},[d,o.id]);const i=async()=>{const{data:t}=await $.get(`/admin/users/permissions/${o.id}`),s=[];B.map(l=>{const m=t.find(x=>x.permissionId==l.id);s.push({permissionId:l.id,userId:o.id,isPermitted:m?m.isPermitted:!1})}),q.map(l=>{const m=t.find(x=>x.permissionId==l.id);s.push({permissionId:l.id,userId:o.id,isPermitted:m?m.isPermitted:!1})}),J.map(l=>{const m=t.find(x=>x.permissionId==l.id);s.push({permissionId:l.id,userId:o.id,isPermitted:m?m.isPermitted:!1})}),Y.map(l=>{const m=t.find(x=>x.permissionId==l.id);s.push({permissionId:l.id,userId:o.id,isPermitted:m?m.isPermitted:!1})}),n([...s])},c=(t,s)=>{const l=t.replace("PAGE_","").replace("APP_","").replace("SALES_","").replace("REPORTS",""),m=r.findIndex(x=>x.permissionId==l);m>-1&&(r[m].isPermitted=!!s,n([...r]),console.log(r[m].isPermitted))},p=async()=>{try{await $.post(`/admin/users/permissions/${o.id}`,r),P.success("Permissões Gravadas!"),a()}catch(t){console.error(t),P.error(ge(t))}},u=t=>{const s=t.replace("PAGE_","").replace("APP_","").replace("SALES_","").replace("REPORTS",""),l=r.find(m=>m.permissionId==s);return l?l.isPermitted:!1};return e.jsx(Z,{open:d,onOpenChange:a,children:e.jsxs(ee,{children:[e.jsxs(se,{children:[e.jsxs(oe,{children:["Permissões do Usuário:"," ",e.jsx("span",{className:"text-blue-600 font-semibold",children:o.id})]}),e.jsx(ae,{})]}),e.jsx("div",{children:e.jsxs(as,{type:"single",collapsible:!0,children:[e.jsxs(S,{value:"pages",children:[e.jsx(w,{children:"Páginas"}),e.jsx(y,{children:e.jsx("div",{className:"flex flex-col gap-1 p-2",children:B.map(t=>{const s=`PAGE_${t.id}`;return e.jsxs(C,{className:"flex items-center gap-2 cursor-pointer",htmlFor:s,children:[e.jsx(I,{id:s,checked:u(s),onCheckedChange:l=>c(s,l)}),t.label]},s)})})})]}),e.jsxs(S,{value:"app",children:[e.jsx(w,{children:"App"}),e.jsx(y,{children:e.jsx("div",{className:"flex flex-col gap-1 p-2",children:q.map(t=>{const s=`APP_${t.id}`;return e.jsxs(C,{className:"flex items-center gap-2 cursor-pointer",htmlFor:s,children:[e.jsx(I,{id:s,checked:u(s),onCheckedChange:l=>c(s,l)}),t.label]},s)})})})]}),e.jsxs(S,{value:"sales",children:[e.jsx(w,{children:"Vendas"}),e.jsx(y,{children:e.jsx("div",{className:"flex flex-col gap-1 p-2",children:J.map(t=>{const s=`SALES_${t.id}`;return e.jsxs(C,{className:"flex items-center gap-2 cursor-pointer",htmlFor:s,children:[e.jsx(I,{id:s,checked:u(s),onCheckedChange:l=>c(s,l)}),t.label]},s)})})})]}),e.jsxs(S,{value:"reports",children:[e.jsx(w,{children:"Relatórios"}),e.jsx(y,{children:e.jsx("div",{className:"flex flex-col gap-1 p-2",children:Y.map(t=>{const s=`REPORTS_${t.id}`;return e.jsxs(C,{className:"flex items-center gap-2 cursor-pointer",htmlFor:s,children:[e.jsx(I,{id:s,checked:u(s),onCheckedChange:l=>c(s,l)}),t.label]},s)})})})]})]})}),e.jsxs(re,{children:[e.jsx(A,{type:"button",onClick:p,variant:"green",children:"Gravar"}),e.jsx(A,{type:"button",onClick:a,variant:"secondary",children:"Fechar"})]})]})})},ts=({user:o,isOpen:d,onClose:a})=>{const[r,n]=v.useState(""),[i,c]=v.useState(""),[p,u]=v.useState(!1),t=async()=>{u(!0);try{if(i!==r){P.warning("Senha não confere!");return}await new X().changePassword(o.id,r),P.success("Senha Alterada!"),a()}catch(s){console.log(s),P.error(s.message)}finally{u(!1)}};return e.jsx(Z,{open:d,onOpenChange:a,children:e.jsxs(ee,{children:[e.jsxs(se,{children:[e.jsxs(oe,{children:["Alterar Senha do Usuário:"," ",e.jsx("span",{className:"text-blue-600 font-semibold",children:o.id})]}),e.jsx(ae,{})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"form-group",children:[e.jsx(C,{children:"Nova Senha:"}),e.jsx(K,{type:"password",value:r,onChange:s=>n(s.target.value),maxLength:50})]}),e.jsxs("div",{className:"form-group",children:[e.jsx(C,{children:"Confirmação:"}),e.jsx(K,{type:"password",maxLength:50,value:i,onChange:s=>c(s.target.value)})]})]}),e.jsxs(re,{children:[e.jsx(A,{type:"button",onClick:()=>t(),variant:"green",disabled:p,children:"Alterar a Senha"}),e.jsx(A,{type:"button",onClick:()=>a(),variant:"secondary",disabled:p,children:"Cancelar"})]})]})})},ns=[{id:"id",label:"Código"},{id:"name",label:"Nome"},{id:"email",label:"E-mail"}],Us=function(){const[d,a]=v.useState(new Date().valueOf()),[r,n]=v.useState(!1),[i,c]=v.useState(null),[p,u]=v.useState(!1),t=ve(),{showAppDialog:s}=Ae(),l=()=>{t({to:"/admin/users/new-user"})},m=f=>{t({to:`/admin/users/${f.id}`})},x=async f=>{await s({type:"confirm",title:"Atenção",message:"Excluir este Usuário?",buttons:[{text:"Excluir",variant:"danger",value:"ok",autoClose:!0},{text:"Cancelar",variant:"secondary",value:"",autoClose:!0}]})&&(await new X().delete(f.id),a(new Date().valueOf()))},R=f=>{c(f),n(!0)},j=f=>{c(f),u(!0)};return e.jsxs(Ce,{titleSlot:"Manutenção de Usuários",children:[e.jsx("div",{className:"p-2",children:e.jsx(je,{defaultSearchField:"name",defaultSortFieldDataIndex:"name",searchFields:ns,columns:Ve({fnEdit:m,fnDelete:x,fnPermissions:R,fnChangePassword:j}),showAddButton:!0,onAdd:()=>l(),dataUrl:"/admin/users/list-paged"},d)}),r&&i&&e.jsx(rs,{isOpen:r,onClose:()=>{c(null),n(!1)},user:i}),p&&i&&e.jsx(ts,{isOpen:p,onClose:()=>{c(null),u(!1)},user:i})]})};export{Us as component};
