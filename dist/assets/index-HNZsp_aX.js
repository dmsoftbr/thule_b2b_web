import{g as l,j as e,r as i,t as y,h as P,l as F,e as V}from"./index-C-yn2kxu.js";import{A as O}from"./app-page-header-B97b6w1v.js";import{S as C}from"./server-table-OrazAZj6.js";import{A as M}from"./app-tooltip-1VY1K540.js";import{B as d}from"./index-Cj-kxx9Z.js";import{S as w}from"./square-pen-C5Wms97H.js";import{T as N}from"./trash-DuwzUJ5T.js";import{U as B}from"./users-eyeCmsy7.js";import{D as q,a as R,b as H,c as G,d as Q,f as J}from"./dialog-o4W0LXdK.js";import{f as K}from"./number-utils-BjpbXa09.js";import{L as I}from"./label-PvIEZhsH.js";import{S as D,c as W}from"./search-combo-DoY-PKU3.js";import{N as X}from"./react-number-format.es-C6TcdqBX.js";import{v as Y}from"./v4-BKrj-4V8.js";import"./input-Dr2m_CVc.js";import"./select-BqrgrOas.js";import"./index-D5w6tM8m.js";import"./Combination-BJv6NSEb.js";import"./index-z0-V-lU6.js";import"./index-BoUYBFaC.js";import"./index-Cap87g99.js";import"./chevron-down-lpqsW9lE.js";import"./index-Dtymrjkl.js";import"./search-8CyYJVSP.js";import"./funnel-CSCaqyL5.js";import"./loader-circle-BV1pYLGQ.js";import"./chevron-left-DklgzkMt.js";import"./chevron-right-CCWYEIpL.js";import"./index-DRosYylb.js";import"./index-C8Qjzrxd.js";import"./command-DF-KUbv3.js";import"./popover-D4FvDG7G.js";import"./chevrons-up-down-DXmsIWP1.js";class Z{static basePath="registrations/approval-level-limits";static async getAll(){return(await l.get(`/${this.basePath}/all`)).data}static async getById(s){return(await l.get(`/${this.basePath}/id/${s}`)).data}static async listPaged(s){return(await l.post(`/${this.basePath}/list-paged`,s)).data}static async create(s){return(await l.post(`/${this.basePath}`,s)).data}static async update(s,a){return(await l.patch(`/${this.basePath}/${s}`,a)).data}static async delete(s){await l.delete(`/${this.basePath}/${s}`)}}const _=({fnConfig:c,fnEdit:s,fnDelete:a})=>[{title:"Descrição",dataIndex:"description",key:"description",sortable:!0},{title:"Tipo",dataIndex:"type",key:"type",sortable:!0,renderItem:r=>e.jsx("span",{children:r.type=="UNIQUE"?"Aprovador Único":"Cadeia"})},{title:"Ações",dataIndex:"id",key:"actions",renderItem:r=>e.jsxs("div",{className:"flex flex-wrap gap-x-1 items-center",children:[e.jsx(d,{size:"sm",type:"button",onClick:()=>{s(r)},children:e.jsx(w,{className:"size-4"})}),e.jsx(d,{size:"sm",variant:"destructive",type:"button",onClick:()=>{a(r)},children:e.jsx(N,{className:"size-4"})}),e.jsx(M,{message:"Usuários e Limites",children:e.jsx(d,{size:"sm",variant:"secondary",type:"button",onClick:()=>{c(r)},children:e.jsx(B,{className:"size-4"})})})]})}],ee=({fnEdit:c,fnDelete:s})=>[{title:"Usuário",dataIndex:"userId",key:"userId",sortable:!0,renderItem:a=>e.jsx("span",{className:"text-blue-600 font-semibold",children:a.userId})},{title:"Alternativo",dataIndex:"alternativeId",key:"alternativeId",sortable:!0},{title:"Limite R$",dataIndex:"limitValue",key:"limitValue",sortable:!0,renderItem:a=>e.jsx("span",{children:K(a.limitValue,2)})},{title:"Ações",dataIndex:"id",key:"actions",renderItem:a=>e.jsxs("div",{className:"flex flex-wrap gap-x-1 items-center",children:[e.jsx(d,{size:"sm",type:"button",onClick:()=>{c(a)},children:e.jsx(w,{className:"size-4"})}),e.jsx(d,{size:"sm",variant:"destructive",type:"button",onClick:()=>{console.log(a),s(a)},children:e.jsx(N,{className:"size-4"})})]})}],te=({isOpen:c,onClose:s,approvalLevel:a})=>{const[r,n]=i.useState(!1),[v,u]=i.useState(!1),[x,h]=i.useState(""),[m,g]=i.useState([]),[p,f]=i.useState(""),[o,j]=i.useState(""),[S,b]=i.useState(0),[k,A]=i.useState(new Date().valueOf()),U=t=>{u(!1),h(t.id),b(t.limitValue),f(t.userId),j(t.alternativeId),n(!0)},z=async t=>{await l.delete(`/registrations/approval-level-limits/${t.id}`),A(new Date().valueOf())},T=()=>{u(!0),h(Y()),b(0),n(!0)},$=async()=>{const{data:t}=await l.get("/admin/users/all");g(W(t,"id","id",!1))},L=async()=>{if(!p){y.warning("Selecione o Usuário que será Aprovador");return}if(p==o){y.warning("Alternativo selecionado não pode ser igual ao Aprovador");return}const t={userId:p,alternativeId:o,limitValue:S,levelId:a.id,id:x};try{v?(await l.post("/registrations/approval-level-limits",t),n(!1)):(await l.patch("/registrations/approval-level-limits",t),n(!1))}catch(E){y.error(P(E))}finally{A(new Date().valueOf())}};return i.useEffect(()=>{$()},[]),e.jsx(q,{open:c,onOpenChange:s,children:e.jsxs(R,{className:"min-w-4/12",children:[e.jsxs(H,{children:[e.jsxs(G,{children:["Configuração de Usuários / Limites: ",a.description]}),e.jsx(Q,{children:"Utilize esta tela para configurar quem terá acesso a aprovação."})]}),e.jsxs("div",{className:"relative",children:[e.jsx(C,{columns:ee({fnEdit:U,fnDelete:z}),dataUrl:"/registrations/approval-level-limits/list-paged",additionalInfo:{levelId:a.id},searchFields:[{id:"userId",label:"Usuário"}],defaultSearchField:"userId",onAdd:()=>T()},k),r&&e.jsxs("div",{className:"absolute inset-0 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-neutral-900/30 z-[1000]"}),e.jsx("div",{className:"bg-neutral-200 z-[1001] min-w-full p-10 rounded-lg",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"form-group",children:[e.jsx(I,{children:"Usuário"}),e.jsx(D,{defaultValue:m.filter(t=>t.value==p)??void 0,staticItems:m,onChange:t=>{f(t)}})]}),e.jsxs("div",{className:"form-group",children:[e.jsx(I,{children:"Alternativo"}),e.jsx(D,{defaultValue:m.filter(t=>t.value==o)??void 0,staticItems:m,onChange:t=>{j(t)},deSelectOnClick:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx(I,{children:"Limite R$"}),e.jsx(X,{decimalScale:2,fixedDecimalScale:!0,className:"form-input",decimalSeparator:",",thousandSeparator:".",allowNegative:!1,value:S,onValueChange:t=>b(t.floatValue??0)})]}),e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(d,{onClick:()=>L(),children:"Gravar"}),e.jsx(d,{variant:"secondary",onClick:()=>n(!1),children:"Fechar"})]})]})})]})]}),e.jsx(J,{children:e.jsx(d,{onClick:()=>s(),children:"Fechar"})})]})})},ae=[{id:"id",label:"Código"},{id:"description",label:"Descrição"}],Pe=function(){const[s,a]=i.useState(new Date().valueOf()),[r,n]=i.useState(!1),[v,u]=i.useState(null),{showAppDialog:x}=F(),h=V(),m=()=>{h({to:"/registrations/approval-levels/new-level"})},g=o=>{h({to:`/registrations/approval-levels/${o.id}`})},p=async o=>{await x({type:"confirm",title:"Atenção",message:"Excluir esta Alçada de Aprovação?",buttons:[{text:"Excluir",variant:"danger",value:"ok",autoClose:!0},{text:"Cancelar",variant:"secondary",value:"",autoClose:!0}]})&&(await Z.delete(o.id),a(new Date().valueOf()))},f=o=>{u(o),n(!0)};return e.jsxs(O,{titleSlot:"Manutenção de Alçadas de Aprovação",children:[e.jsx("div",{className:"p-2",children:e.jsx(C,{defaultSearchField:"description",defaultSortFieldDataIndex:"description",searchFields:ae,columns:_({fnEdit:g,fnDelete:p,fnConfig:f}),showAddButton:!0,onAdd:()=>m(),dataUrl:"/registrations/approval-levels/list-paged"},s)}),r&&v&&e.jsx(te,{approvalLevel:v,isOpen:r,onClose:()=>{n(!1),u(null)}})]})};export{Pe as component};
