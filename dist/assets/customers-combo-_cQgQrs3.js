import{r,j as n,g as F}from"./index-C-yn2kxu.js";import{N as T}from"./react-number-format.es-C6TcdqBX.js";import{I as U}from"./input-Dr2m_CVc.js";import{B as A,c as z}from"./index-Cj-kxx9Z.js";import{C as J}from"./chevron-down-lpqsW9lE.js";import{C as O}from"./select-BqrgrOas.js";import{C as G,a as Q,b as q,c as M,d as H,e as K}from"./command-DF-KUbv3.js";import{P as V,a as W,b as X}from"./popover-D4FvDG7G.js";import{f as P}from"./string-utils-DZ7LWdPC.js";import{a as Y}from"./index-Dtymrjkl.js";import{u as Z}from"./use-auth-BWk16BUZ.js";import{C as _}from"./chevrons-up-down-DXmsIWP1.js";const fe=r.forwardRef(({stepper:e,thousandSeparator:C,placeholder:m,defaultValue:l=0,min:a=-1/0,max:u=1/0,onValueChange:h,fixedDecimalScale:x=!1,decimalScale:v=0,suffix:p,prefix:w,value:t,minusSlot:j,plusSlot:g,disabled:f,...E},y)=>{const[o,c]=r.useState(t??l),b=r.useRef(null),S=r.useCallback(()=>{f||c(i=>i===void 0?e??1:Math.min(i+(e??1),u))},[e,u]),N=r.useCallback(()=>{f||c(i=>i===void 0?-(e??1):Math.max(i-(e??1),a))},[e,a]);r.useEffect(()=>()=>{},[S,N,y]),r.useEffect(()=>{t!==void 0&&c(t)},[t]);const I=i=>{if(f)return;const k=i.floatValue===void 0?void 0:i.floatValue;c(k),h&&h(k)},D=()=>{o!==void 0&&b&&b.current&&(o<a?(c(a),b.current.value=String(a)):o>u&&(c(u),b.current.value=String(u)))};return n.jsxs("div",{className:"flex items-center",children:[n.jsx(A,{"aria-label":"Diminuir Valor",className:"px-2 h-9 rounded-r-none rounded-tr-none border-input border-r-0 focus-visible:relative",variant:"outline",onClick:N,disabled:f||o===a,children:j||n.jsx(J,{size:15})}),n.jsx(T,{value:o,onValueChange:I,thousandSeparator:C,decimalScale:v,fixedDecimalScale:x,allowNegative:a<0,valueIsNumericString:!0,onBlur:D,max:u,min:a,suffix:p,prefix:w,customInput:U,placeholder:m,className:"[appearance:textfield] min-w-[60px] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none text-center rounded-none relative",getInputRef:b,disabled:f,...E}),n.jsx("div",{className:"flex flex-col",children:n.jsx(A,{"aria-label":"Aumentar Valor",className:"px-2 h-9 rounded-tl-none rounded-bl-none border-input border-l-0 border-b-[0.5px] focus-visible:relative",variant:"outline",onClick:S,disabled:f||o===u,children:g||n.jsx(O,{size:15})})})]})}),B=r.memo(({item:e,value:C,onSelect:m,closeOnSelect:l,setIsOpen:a})=>{const u=r.useMemo(()=>[e.id.toString(),e.abbreviation,...e.name.trim().split(" "),e.documentNumber],[e.id,e.abbreviation,e.name,e.documentNumber]),h=r.useCallback(()=>{m?.(e),l&&a(!1)},[e,m,l,a]),x=r.useMemo(()=>P(e.documentNumber),[e.documentNumber]),v=r.useMemo(()=>e.name.toUpperCase(),[e.name]),p=C===e.id;return n.jsx(K,{disabled:!e.isActive,value:e.id.toString(),onSelect:h,keywords:u,className:z("even:bg-neutral-50 border-t rounded-none cursor-pointer",p&&"!bg-blue-100"),children:n.jsxs("div",{className:"flex flex-col w-full",children:[n.jsx("div",{className:"w-full flex-1 flex justify-between items-center",children:n.jsxs("span",{className:"font-bold text-blue-600",children:[e.id," - ",e.abbreviation]})}),n.jsxs("p",{className:"text-xs text-muted-foreground",children:[v," - CPF/CNPJ: ",x]})]})},e.id)});B.displayName="CustomerItem";const me=({disabled:e,onSelect:C,onPreSelect:m,defaultValue:l,closeOnSelect:a=!1})=>{const[u,h]=r.useState(!1),[x,v]=r.useState([]),[p,w]=r.useState(l),[t,j]=r.useState(void 0),[g,f]=r.useState(""),[E,y]=r.useState(!1),{session:o}=Z(),c=r.useRef(null),b=r.useRef(!0),S=r.useCallback(async s=>{if(o?.user.id){c.current&&c.current.abort(),c.current=new AbortController;try{y(!0);const{data:d}=await F.post(`/registrations/customers/search/${o.user.id}`,{search:s},{signal:c.current.signal});v(d)}catch(d){d.name!=="CanceledError"&&d.name!=="AbortError"&&(console.error("Erro ao buscar clientes:",d),v([]))}finally{y(!1)}}},[o?.user.id]),N=Y(S,300),I=r.useMemo(()=>t?P(t.documentNumber):"",[t]),D=r.useMemo(()=>t?n.jsxs("div",{children:[`${t.id} - ${t.abbreviation}`," -"," ",n.jsxs("span",{className:"text-xs text-muted-foreground",children:["CPF/CNPJ: ",I]})]}):"Selecione o Cliente",[t,I]),i=r.useCallback(s=>{w(s.id),j(s),C?.(s)},[C]),k=r.useCallback(s=>{if(s.id!==p){if(m){m(s,t,()=>{i(s)},()=>{});return}i(s)}},[p,m,t,i]);r.useEffect(()=>{N(g)},[g,N]),r.useEffect(()=>{l&&b.current&&o?.user.id&&(b.current=!1,w(l),(async()=>{try{const{data:d}=await F.post(`/registrations/customers/search/${o.user.id}`,{search:l.toString()});if(Array.isArray(d)){const R=d.find($=>$.id===l);R&&j(R)}}catch(d){console.error("Erro ao buscar cliente padrão:",d)}})())},[l,o?.user.id]),r.useEffect(()=>()=>{c.current&&c.current.abort()},[]);const L=r.useCallback(s=>{h(s),s||f("")},[]);return n.jsxs(V,{open:u,onOpenChange:L,children:[n.jsx(W,{asChild:!0,children:n.jsxs(A,{disabled:e,useAnimation:!1,variant:"outline",role:"combobox",className:"w-full justify-between hover:not-disabled:!bg-white disabled:bg-neutral-200",children:[D,n.jsx(_,{className:"opacity-50"})]})}),n.jsx(X,{className:"p-0 w-popover",children:n.jsxs(G,{shouldFilter:!1,children:[n.jsx(Q,{placeholder:"Procurar...",className:"h-9",onValueChange:f}),n.jsxs(q,{children:[E?n.jsx(M,{children:"Carregando..."}):x.length===0?n.jsx(M,{children:"Cliente não encontrado"}):null,n.jsx(H,{className:"p-0",children:x.map(s=>n.jsx(B,{item:s,value:p,onSelect:k,closeOnSelect:a,setIsOpen:h},s.id))})]})]})})]})};export{me as C,fe as F};
