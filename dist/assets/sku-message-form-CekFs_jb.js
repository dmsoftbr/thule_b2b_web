import{o as L,s as I,r,g as v,j as s,t as C,h as R}from"./index-C-yn2kxu.js";import{c as F,B as S}from"./index-Cj-kxx9Z.js";import{u as A,F as M}from"./form-wZZtDwF0.js";import{a as T}from"./zod-CLHPmu1F.js";import{F as D}from"./form-textarea-Clc_Qz6G.js";import{L as O}from"./label-PvIEZhsH.js";import{e as V,C as G,a as $,b as B,c as U,d as W}from"./command-DF-KUbv3.js";import{P as _,a as q,b as z}from"./popover-D4FvDG7G.js";import{P as H}from"./product-image-870267Xw.js";import{C as J}from"./chevrons-up-down-DXmsIWP1.js";const K=L({productId:I(),message:I()}),Q=({className:t,disabled:g,defaultValue:n="",onSelect:m,closeOnSelect:i=!1})=>{const[c,h]=r.useState(!1),[p,o]=r.useState([]),[a,b]=r.useState(!1),[l,w]=r.useState(n),x=r.useRef(null),f=r.useRef(void 0),d=r.useRef(null),P=r.useMemo(()=>{if(!l)return"";const e=p.find(u=>u.id===l);return e?`${e.id} - ${e.description}`:""},[l,p]),j=r.useCallback(async e=>{if(d.current&&d.current.abort(),!e.trim()){o([]),b(!1);return}b(!0),d.current=new AbortController;try{const{data:u}=await v.post("/registrations/products/search-all",{search:e},{signal:d.current.signal});o(u)}catch(u){u.name!=="AbortError"&&(console.error("Erro na busca:",u),o([]))}finally{b(!1)}},[]);r.useEffect(()=>{n&&j(n)},[n]);const N=r.useCallback(e=>{f.current&&clearTimeout(f.current),f.current=window.setTimeout(()=>{j(e)},300)},[j]),y=r.useCallback(e=>{w(e.id),m?.(e),i&&h(!1),x.current&&(x.current.value="",x.current.focus())},[m,i]),k=r.useMemo(()=>({item:e})=>s.jsx(V,{disabled:!e.isActive,value:e.id.toString(),onSelect:()=>y(e),keywords:[e.id,e.referenceCode,e.description],className:F("even:bg-neutral-50 border-t rounded-none",t,l===e.id.toString()&&"!bg-blue-100"),children:s.jsxs("div",{className:"grid grid-cols-[128px_1fr] gap-2",children:[s.jsx("div",{className:"w-[128px] h-[128px] relative bg-transparent flex-shrink-0",children:s.jsx(H,{productId:`${e.id}`,alt:"Foto do Produto"})}),s.jsxs("div",{className:"flex flex-col justify-center min-w-0",children:[s.jsxs("span",{className:"font-bold text-blue-600 truncate",children:[e.id," - ",e.description]}),s.jsxs("p",{className:"text-xs text-muted-foreground truncate",children:["Classificação: ",e.productGroup?.name]})]})]})},e.id),[t,l,y]),E=r.useCallback(e=>{h(e),e||(f.current&&clearTimeout(f.current),d.current&&d.current.abort())},[]);return s.jsxs(_,{open:c,onOpenChange:E,children:[s.jsx(q,{asChild:!0,disabled:g,children:s.jsxs(S,{type:"button",variant:"outline",role:"combobox",className:"w-full flex-1 justify-between hover:not-disabled:!bg-white",children:[l?P:a?"Procurando...":"Selecione o Produto",s.jsx(J,{className:"opacity-50"})]})}),s.jsx(z,{className:"p-0 w-popover",children:s.jsxs(G,{shouldFilter:!1,children:[s.jsx($,{ref:x,placeholder:"Procurar...",className:"h-9",onValueChange:N}),s.jsxs(B,{children:[s.jsx(U,{children:a?"Carregando...":l?"Produto não cadastrado na lista de preço ou não disponível para seu canal de vendas.":"Digite o termo a procurar: Código Longo/Código Curto/Descrição"}),s.jsx(W,{className:"p-0",children:p.map(e=>s.jsx(k,{item:e},e.id))})]})]})})]})},ce=({initialData:t,mode:g,onClose:n})=>{const[m,i]=r.useState(!1),c=A({resolver:T(K),defaultValues:{productId:"",message:""}}),h=async o=>{try{let a={...o};i(!0),g=="ADD"?(await v.post("/registrations/sku-messages",a),C.success("Registro criado com sucesso!")):(await v.patch("/registrations/sku-messages",a),C.success("Registro alterado com sucesso!")),n(!0),i(!1)}catch(a){console.log(a),C.error(R(a))}finally{i(!1)}};r.useEffect(()=>{t&&c.reset(t)},[t]);const p=g=="VIEW";return s.jsx(M,{...c,children:s.jsxs("form",{onSubmit:c.handleSubmit(h,o=>console.log(o)),className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx(O,{children:"Produto"}),s.jsx(Q,{onSelect:o=>c.setValue("productId",o?.id??""),defaultValue:t?.productId??"",closeOnSelect:!0})]}),s.jsx(D,{control:c.control,name:"message",label:"Mensagem"}),s.jsxs("div",{className:"flex items-end justify-end gap-x-2",children:[!p&&s.jsx(S,{disabled:m,type:"submit",variant:"green",children:"Gravar"}),s.jsx(S,{disabled:m,type:"button",variant:"secondary",onClick:()=>n(!1),children:"Voltar p/Lista"})]})]})})};export{ce as S};
