import{r as l,j as e,X as K}from"./index-C-yn2kxu.js";import{I as Q}from"./input-Dr2m_CVc.js";import{S as R}from"./search-8CyYJVSP.js";import{c as U,S as Y,b as Z,a as _,F as O}from"./square-oq4V5Qgv.js";import{C as ee}from"./chevron-down-lpqsW9lE.js";import{C as te}from"./chevron-right-CCWYEIpL.js";const d=t=>String(t),B=t=>{const o=new Set,p=g=>{for(const h of g)h.checked&&o.add(d(h.id)),h.children&&p(h.children)};return p(t),o},se=({checked:t,indeterminate:o,onChange:p,isReadOnly:g})=>e.jsxs("button",{type:"button",disabled:g,onClick:h=>{h.stopPropagation(),p()},className:`w-4 h-4 rounded border flex items-center justify-center transition-colors focus:outline-none ${t||o?"bg-blue-600 border-blue-600":"bg-white border-gray-300 hover:border-gray-400"} ${g?"opacity-50 cursor-not-allowed":""}`,children:[t&&e.jsx("svg",{className:"w-3 h-3 text-white",viewBox:"0 0 12 12",fill:"none",children:e.jsx("path",{d:"M10 3L4.5 8.5L2 6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),o&&!t&&e.jsx("div",{className:"w-2 h-0.5 bg-white"})]}),V=({node:t,level:o,expandedNodes:p,checkedStates:g,onToggleExpand:h,onToggleCheck:M,searchTerm:v,filteredNodeIds:N,isReadOnly:I=!1})=>{const x=d(t.id),i=t.children&&t.children.length>0,k=p.has(x),y=g.get(x)||{checked:!1,indeterminate:!1},C=o*20,S=!N||N.has(x),L=l.useMemo(()=>{if(!v)return t.label;const f=t.label.split(new RegExp(`(${v})`,"gi"));return e.jsx(e.Fragment,{children:f.map((j,$)=>j.toLowerCase()===v.toLowerCase()?e.jsx("span",{className:"bg-yellow-200 font-semibold text-black",children:j},$):j)})},[t.label,v]),F=l.useCallback(()=>{M(x)},[x,M]),E=l.useCallback(f=>{f.stopPropagation(),i&&h(x)},[i,x,h]);return S?e.jsxs("div",{className:"select-none",id:t.id,children:[e.jsxs("div",{className:"flex items-center py-1 px-2 hover:bg-gray-50 rounded-sm group transition-colors",style:{paddingLeft:`${C+8}px`},children:[e.jsx("button",{type:"button",onClick:E,className:`w-4 h-4 flex items-center justify-center mr-1 rounded-sm hover:bg-gray-200 transition-colors focus:outline-none ${i?"":"invisible"}`,disabled:!i,children:i&&(k?e.jsx(ee,{className:"w-3 h-3 text-gray-600"}):e.jsx(te,{className:"w-3 h-3 text-gray-600"}))}),e.jsx("div",{className:"mr-2",children:e.jsx(se,{checked:y.checked,indeterminate:y.indeterminate,onChange:F,isReadOnly:I})}),e.jsx("div",{className:"mr-2",children:i?k?e.jsx(Z,{className:"w-4 h-4 text-yellow-500"}):e.jsx(_,{className:"w-4 h-4 text-yellow-500"}):e.jsx(O,{className:"w-4 h-4 text-gray-500"})}),e.jsx("span",{className:"text-sm text-gray-700 flex-1 truncate cursor-pointer",onClick:E,children:L})]}),i&&k&&e.jsx("div",{children:t.children.map(f=>e.jsx(V,{node:f,level:o+1,expandedNodes:p,checkedStates:g,onToggleExpand:h,onToggleCheck:M,searchTerm:v,filteredNodeIds:N,isReadOnly:I},d(f.id)))})]}):null},ae=({data:t,onSelectionChange:o,className:p="",searchable:g=!0,isReadOnly:h=!1,searchPlaceholder:M="Buscar...",showSelectAllButtons:v=!0,isLoading:N=!1})=>{const[I,x]=l.useState(new Set),[i,k]=l.useState(""),[y,C]=l.useState(()=>B(t)),S=l.useMemo(()=>{const s=[],n=r=>{for(const c of r)s.push(d(c.id)),c.children&&n(c.children)};return n(t),s.join("|")},[t]),L=l.useRef(S);l.useEffect(()=>{if(S!==L.current){const s=B(t);C(s),L.current=S}},[S,t]);const F=l.useMemo(()=>{const s=new Map,n=r=>{for(const c of r)s.set(d(c.id),c),c.children&&n(c.children)};return n(t),s},[t]),E=l.useMemo(()=>{const s=new Map,n=(r,c)=>{for(const u of r)c&&s.set(d(u.id),c),u.children&&n(u.children,u)};return n(t),s},[t]),f=l.useMemo(()=>{if(!i.trim())return new Set;const s=new Set,n=i.toLowerCase(),r=(c,u=[])=>{let w=!1;for(const m of c){const a=d(m.id),b=[...u,a],A=m.label.toLowerCase().includes(n);let z=!1;m.children&&(z=r(m.children,b)),(A||z)&&(b.forEach(T=>s.add(T)),w=!0)}return w};return r(t),s},[t,i]);l.useEffect(()=>{i.trim()&&f.size>0&&x(new Set(f))},[i,f]);const j=l.useMemo(()=>{const s=new Map,n=r=>{const c=d(r.id),u=y.has(c);let w=!0,m=!1,a=!1;if(r.children&&r.children.length>0)for(const J of r.children){const P=n(J);P.checked||(w=!1),P.checked&&(m=!0),P.indeterminate&&(a=!0)}else w=u,m=u;const b=r.children&&r.children.length>0?w:u,T={checked:b,indeterminate:!b&&(m||a||u&&!b)};return s.set(c,T),T};return t.forEach(r=>n(r)),s},[y,t]),$=l.useCallback(s=>{if(h)return;const n=new Set(y),r=F.get(s);if(!r)return;const u=j.get(s)?.checked??!1,w=a=>{n.add(d(a.id)),a.children&&a.children.forEach(w)},m=a=>{n.delete(d(a.id)),a.children&&a.children.forEach(m)};if(u){m(r);let a=r;for(;a;){const b=E.get(d(a.id));b&&n.add(d(b.id)),a=b}}else w(r);C(n),o&&o(Array.from(n))},[y,F,E,h,j,o]),q=l.useCallback(()=>k(""),[]),D=l.useCallback(()=>{const s=new Set,n=r=>{for(const c of r)s.add(d(c.id)),c.children&&n(c.children)};n(t),C(s),o&&o(Array.from(s))},[t,o]),W=l.useCallback(()=>{C(new Set),o&&o([])},[o]),X=l.useCallback(s=>{x(n=>{const r=new Set(n);return r.has(s)?r.delete(s):r.add(s),r})},[]),G=t.length>0&&t.every(s=>j.get(d(s.id))?.checked),H=y.size===0&&!t.some(s=>j.get(d(s.id))?.indeterminate);return e.jsxs("div",{className:`bg-white border border-gray-200 rounded-md flex flex-col h-full ${p}`,children:[e.jsxs("div",{className:"flex-none border-b border-gray-200 bg-gray-50/50",children:[g&&e.jsx("div",{className:"p-2 border-b border-gray-100",children:e.jsxs("div",{className:"relative",children:[e.jsx(R,{className:"absolute left-2.5 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx(Q,{type:"text",placeholder:M,value:i,onChange:s=>k(s.target.value),className:"w-full pl-9 pr-8 h-9 text-sm"}),i&&e.jsx("button",{type:"button",onClick:q,className:"absolute right-2.5 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 focus:outline-none",children:e.jsx(K,{className:"w-3 h-3"})})]})}),v&&!h&&e.jsx("div",{className:"p-2 flex gap-2 justify-between items-center bg-white",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{type:"button",onClick:D,disabled:G||N,className:"text-xs flex items-center gap-1 px-2 py-1 text-blue-700 bg-blue-50 border border-blue-200 rounded hover:bg-blue-100 disabled:opacity-50 transition-colors",children:[e.jsx(U,{className:"w-3 h-3"}),"Todos"]}),e.jsxs("button",{type:"button",onClick:W,disabled:H||N,className:"text-xs flex items-center gap-1 px-2 py-1 text-gray-700 bg-gray-50 border border-gray-200 rounded hover:bg-gray-100 disabled:opacity-50 transition-colors",children:[e.jsx(Y,{className:"w-3 h-3"}),"Nenhum"]})]})})]}),e.jsx("div",{className:"flex-1 p-2 relative overflow-hidden min-h-[200px]",children:N?e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-white/80 z-10",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"w-6 h-6 border-2 border-blue-600 border-t-transparent rounded-full animate-spin mb-2"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Carregando..."})]})}):e.jsx("div",{className:"h-full overflow-y-auto pr-1 custom-scrollbar",children:t.length>0?t.map(s=>e.jsx(V,{node:s,level:0,isReadOnly:h,expandedNodes:I,checkedStates:j,onToggleExpand:X,onToggleCheck:$,searchTerm:i,filteredNodeIds:i?f:void 0},d(s.id))):e.jsx("div",{className:"py-8 text-center text-gray-400 text-sm",children:"Nenhum item encontrado"})})})]})};export{ae as T};
