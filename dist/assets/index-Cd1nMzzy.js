import{g as f,r as n,j as e,t as se,h as Se,i as Ce,w as we}from"./index-C-yn2kxu.js";import{A as De}from"./app-page-header-B97b6w1v.js";import{B as x,c as I}from"./index-Cj-kxx9Z.js";import{u as Me}from"./useQuery-BEMaX6S8.js";import{S as ke,a as Re,b as Ee,c as Fe,d as u}from"./select-BqrgrOas.js";import{S as ee}from"./search-combo-DoY-PKU3.js";import{L as h}from"./label-PvIEZhsH.js";import{I as te}from"./input-Dr2m_CVc.js";import{D as ae,a as re,b as le,c as ne,d as oe}from"./dialog-o4W0LXdK.js";import{D as Ae,a as Pe,b as Ge}from"./index-Dm19w64E.js";import{L as ce}from"./loader-circle-BV1pYLGQ.js";import{C as P}from"./checkbox-BvWHDgRj.js";import{S as $}from"./scroll-area-Bnzc--3Y.js";import{N as Ie}from"./react-number-format.es-C6TcdqBX.js";import{F as ze}from"./funnel-CSCaqyL5.js";import{P as Oe}from"./plus-CfhVh8qF.js";import{D as Le}from"./dollar-sign-B45EOowh.js";import{U as Ue}from"./upload-BFRuCWaq.js";import{C as z}from"./chevron-down-lpqsW9lE.js";import{C as O}from"./chevron-right-CCWYEIpL.js";import"./index-D5w6tM8m.js";import"./Combination-BJv6NSEb.js";import"./index-z0-V-lU6.js";import"./index-BoUYBFaC.js";import"./index-Cap87g99.js";import"./command-DF-KUbv3.js";import"./index-C8Qjzrxd.js";import"./index-DRosYylb.js";import"./search-8CyYJVSP.js";import"./popover-D4FvDG7G.js";import"./chevrons-up-down-DXmsIWP1.js";import"./index-DJmz7Thm.js";import"./minus-Cc6YOJ9G.js";class Te{static basePath="registrations/product-commercial-families";static async getAll(){return(await f.get(`/${this.basePath}/all`)).data}static async getById(d){return(await f.get(`/${this.basePath}/id/${d}`)).data}static async listPaged(d){return(await f.post(`/${this.basePath}/list-paged`,d)).data}}const qe=({isOpen:g,onClose:d})=>{const[a,R]=n.useState(!1),[p,b]=n.useState(),N=i=>{console.log(i),b(i)},y=async()=>{if(p?.[0]){R(!0);try{const i=new FormData;i.append("file",p[0]),await f.post("/registrations/representative-goals/import-profitability",i),d(!0)}catch(i){console.error(i),se.error(Se(i))}finally{R(!1)}}};return e.jsx(ae,{open:g,onOpenChange:()=>{if(a)return!1;d(!1)},children:e.jsxs(re,{onInteractOutside:i=>{i.preventDefault()},onEscapeKeyDown:i=>{i.preventDefault()},children:[e.jsxs(le,{children:[e.jsx(ne,{children:"Upload de Metas"}),e.jsx(oe,{children:"Utilize o Relatório Profitability do TOTVS (em .csv) para realizar a importação dos dados das metas."})]}),e.jsx("div",{children:e.jsxs(Ae,{disabled:a,className:"",maxSize:1024*1024*100,minSize:1024,onDrop:N,onError:console.error,src:p,children:[e.jsx(Pe,{}),e.jsx(Ge,{})]})}),e.jsxs("div",{className:"flex justify-between w-full flex-1",children:[e.jsx("div",{}),e.jsxs("div",{className:"flex gap-x-2",children:[e.jsxs(x,{variant:"blue",onClick:()=>y(),disabled:a,children:[a&&e.jsxs("div",{className:"flex gap-x-2",children:[e.jsx(ce,{className:"animate-spin"}),"Aguarde..."]}),!a&&e.jsx("span",{children:"Upload"})]}),e.jsx(x,{variant:"secondary",onClick:()=>d(!1),disabled:a,children:"Fechar"})]})]})]})})},Ve=[0,1,2,3,4,5,6,7,8,9,10,11],$e=["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],Qe=({isOpen:g,onClose:d})=>{const[a,R]=n.useState(!1),[p,b]=n.useState([]),[N,y]=n.useState([]),[i,Q]=n.useState([]),[L,B]=n.useState([]),[C,E]=n.useState([]),[G,J]=n.useState([]),[S,F]=n.useState([]),[U,T]=n.useState([]),[w,A]=n.useState([]),[D,q]=n.useState([]),[M,r]=n.useState([]),[c,o]=n.useState(0),[l,K]=n.useState(new Date().getFullYear()),v=async()=>{R(!0);try{const s={year:l,months:p,managers:N,representatives:C,productCommercialFamilies:S,productGroups:w,customerGroups:M,percent:c};await f.post("/registrations/representative-goals/readjust",s),se.success("Reajuste aplicado!"),d(!0)}catch{}finally{R(!1)}},k=()=>{p.length>0?b([]):b([...Ve])},m=s=>p.findIndex(t=>t==s)>-1,Y=s=>{if(m(s)){const t=p.filter(j=>j!=s);b(t)}else b([...p,s])},V=()=>{N.length>0?y([]):y([...i])},H=s=>N.findIndex(t=>t==s)>-1,ie=s=>{if(H(s)){const t=N.filter(j=>j!=s);y(t)}else y([...N,s])},de=async()=>{const{data:s}=await f.get("/registrations/representative-goals/get-managers");Q(s)},me=()=>{if(C.length>0)E([]);else{const s=L.map(t=>t.id);E(s)}},_=s=>C.findIndex(t=>t==s)>-1,xe=s=>{if(_(s)){const t=C.filter(j=>j!=s);E(t)}else E([...C,s])},pe=async()=>{const{data:s}=await f.get("/registrations/representatives/all");B(s)},ue=()=>{if(S.length>0)F([]);else{const s=G.map(t=>t.id);F(s)}},W=s=>S.findIndex(t=>t==s)>-1,he=s=>{if(W(s)){const t=S.filter(j=>j!=s);F(t)}else F([...S,s])},je=async()=>{const{data:s}=await f.get("/registrations/product-commercial-families/all");J(s)},fe=()=>{if(w.length>0)A([]);else{const s=U.map(t=>t.id);A(s)}},X=s=>w.findIndex(t=>t==s)>-1,ge=s=>{if(X(s)){const t=w.filter(j=>j!=s);A(t)}else A([...w,s])},be=async()=>{const{data:s}=await f.get("/registrations/product-groups/all");T(s)},Ne=()=>{if(M.length>0)r([]);else{const s=D.map(t=>t.id);r(s)}},Z=s=>M.findIndex(t=>t==s)>-1,ve=s=>{if(Z(s)){const t=M.filter(j=>j!=s);r(t)}else r([...M,s])},ye=async()=>{const{data:s}=await f.get("/registrations/customer-groups/all");q(s)};return n.useEffect(()=>{g&&(de(),pe(),je(),be(),ye())},[g]),e.jsx(ae,{open:g,onOpenChange:()=>{if(a)return!1;d(!1)},children:e.jsxs(re,{className:"min-w-[90%] w-[90%]",onInteractOutside:s=>{s.preventDefault()},onEscapeKeyDown:s=>{s.preventDefault()},children:[e.jsxs(le,{children:[e.jsx(ne,{children:"Reajuste de Metas"}),e.jsx(oe,{children:"Utilize esta janela para realizar alterações nos valores das metas de forma mais abrangente."})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-2",children:[e.jsxs("div",{className:"flex flex-col gap-y-2",children:[e.jsxs("div",{className:"form-group",children:[e.jsx(h,{children:"Ano"}),e.jsx(te,{disabled:a,type:"number",min:2020,max:2072,step:1,value:l,onChange:s=>K(Number(s.target.value))})]}),e.jsxs("div",{className:"space-y-2 border p-2 rounded-md ",children:[e.jsx("h3",{className:"text-xs text-muted-foreground font-semibold flex items-center gap-x-2",children:"Para os Meses"}),$e.map((s,t)=>e.jsxs(h,{children:[e.jsx(P,{checked:m(t),onCheckedChange:()=>Y(t),disabled:a})," ",s]},t)),e.jsx(x,{type:"button",onClick:()=>k(),size:"sm",className:"text-xs px-1.5 py-0 h-7",disabled:a,children:"Marca/Desmarca"})]})]}),e.jsxs("div",{className:"space-y-2 border p-2 rounded-md ",children:[e.jsx("h3",{className:"text-xs text-muted-foreground font-semibold flex items-center gap-x-2",children:"Para os Gerentes Comerciais"}),i.map((s,t)=>e.jsxs(h,{children:[e.jsx(P,{disabled:a,checked:H(s),onCheckedChange:()=>ie(s)})," ",s]},t)),e.jsx(x,{type:"button",onClick:()=>V(),size:"sm",disabled:a,className:"text-xs px-1.5 py-0 h-7",children:"Marca/Desmarca"})]}),e.jsxs("div",{className:"space-y-2 border p-2 rounded-md ",children:[e.jsx("h3",{className:"text-xs text-muted-foreground font-semibold flex items-center gap-x-2",children:"Para os Representantes"}),e.jsx($,{className:"h-[400px]",children:L.map((s,t)=>e.jsxs(h,{className:"mb-2",children:[e.jsx(P,{disabled:a,checked:_(s.id),onCheckedChange:()=>xe(s.id)})," ",s.id," - ",s.abbreviation]},t))}),e.jsx(x,{type:"button",onClick:()=>me(),size:"sm",disabled:a,className:"text-xs px-1.5 py-0 h-7",children:"Marca/Desmarca"})]}),e.jsxs("div",{className:"space-y-2 border p-2 rounded-md ",children:[e.jsx("h3",{className:"text-xs text-muted-foreground font-semibold flex items-center gap-x-2",children:"Para as Famílias Comerciais"}),e.jsx($,{className:"h-[400px]",children:G.map((s,t)=>e.jsxs(h,{className:"mb-2",children:[e.jsx(P,{disabled:a,checked:W(s.id),onCheckedChange:()=>he(s.id)})," ",s.id," - ",s.name]},t))}),e.jsx(x,{type:"button",onClick:()=>ue(),size:"sm",className:"text-xs px-1.5 py-0 h-7",disabled:a,children:"Marca/Desmarca"})]}),e.jsxs("div",{className:"space-y-2 border p-2 rounded-md ",children:[e.jsx("h3",{className:"text-xs text-muted-foreground font-semibold flex items-center gap-x-2",children:"Para os Grupos de Estoque"}),e.jsx($,{className:"h-[400px]",children:U.map((s,t)=>e.jsxs(h,{className:"mb-2",children:[e.jsx(P,{disabled:a,checked:X(s.id),onCheckedChange:()=>ge(s.id)})," ",s.id," - ",s.name]},t))}),e.jsx(x,{type:"button",onClick:()=>fe(),size:"sm",disabled:a,className:"text-xs px-1.5 py-0 h-7",children:"Marca/Desmarca"})]}),e.jsxs("div",{className:"space-y-2 border p-2 rounded-md ",children:[e.jsx("h3",{className:"text-xs text-muted-foreground font-semibold flex items-center gap-x-2",children:"Para os Grupos de Clientes"}),e.jsx($,{className:"h-[400px]",children:D.map((s,t)=>e.jsxs(h,{className:"mb-2",children:[e.jsx(P,{disabled:a,checked:Z(s.id),onCheckedChange:()=>ve(s.id)})," ",s.id," - ",s.name]},t))}),e.jsx(x,{type:"button",onClick:()=>Ne(),size:"sm",className:"text-xs px-1.5 py-0 h-7",disabled:a,children:"Marca/Desmarca"})]})]}),e.jsx("div",{className:"max-w-xs",children:e.jsxs("div",{className:"form-group",children:[e.jsx(h,{children:"Percentual"}),e.jsx(Ie,{value:c,onValueChange:s=>o(s.floatValue??0),thousandSeparator:".",decimalSeparator:",",decimalScale:2,fixedDecimalScale:!0,allowNegative:!1,valueIsNumericString:!0,max:999999,min:0,suffix:"%",placeholder:"Digite o Percentual",className:"form-input"})]})}),e.jsx("div",{className:"flex justify-between w-full flex-1",children:e.jsxs("div",{className:"flex gap-x-2",children:[e.jsxs(x,{variant:"blue",onClick:()=>v(),disabled:a,children:[a&&e.jsxs("div",{className:"flex gap-x-2",children:[e.jsx(ce,{className:"animate-spin"}),"Aguarde..."]}),!a&&e.jsx("span",{children:"Gravar"})]}),e.jsx(x,{variant:"secondary",onClick:()=>d(!1),disabled:a,children:"Fechar"})]})})]})})};function Be(){const[g,d]=n.useState([]),[a,R]=n.useState([]),[p,b]=n.useState(!1),[N,y]=n.useState(!1),[i,Q]=n.useState([]),[L,B]=n.useState([]),[C,E]=n.useState(new Date().getFullYear()),[G,J]=n.useState(new Date().getMonth()),S=Ce();async function F(){const c=(await new we().getAll()).map(o=>({value:o.id.toString(),label:`${o.abbreviation}`,extra:o,keyworks:[o.id.toString(),o.abbreviation,o.name]}));d(c)}async function U(){const c=(await Te.getAll()).map(o=>({value:o.id.toString(),label:`${o.name}`,extra:o,keyworks:[o.id.toString(),o.name]}));R(c)}n.useEffect(()=>{F(),U()},[]);const[T,w]=n.useState(new Set),{data:A}=Me({queryKey:["rep-goals"],queryFn:async()=>{const r={representativeId:i,productCommercialFamilyId:L,year:C,month:G},{data:c}=await f.post("/registrations/representative-goals/get",r);return w(new Set),c}}),D=r=>{const c=new Set(T);c.has(r)?c.delete(r):c.add(r),w(c)},q=r=>r===void 0?"":r.toLocaleString("pt-BR"),M=(r,c="",o=0)=>r?r.flatMap((l,K)=>{const v=`${c}-${o}-${K}`,k=l.children&&l.children.length>0,m=T.has(v),Y=l.familiaComercial!==void 0;console.log(Y);const V=[e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:I("border-r px-4 py-2 text-sm",m&&l.mesAno&&"bg-neutral-100"),children:e.jsxs("div",{className:"flex items-center",children:[l.mesAno&&k&&e.jsx("button",{className:"h-5 w-5 mr-1 p-0 hover:bg-gray-200 rounded flex items-center justify-center",onClick:()=>D(v),children:m?e.jsx(z,{className:"h-4 w-4"}):e.jsx(O,{className:"h-4 w-4"})}),l.mesAno||""]})}),e.jsx("td",{className:I("border-r px-4 py-2 text-sm",m&&(l.gerenteComercial||l.mesAno)&&"bg-neutral-100"),children:e.jsxs("div",{className:"flex items-center",children:[l.gerenteComercial&&k&&e.jsx("button",{className:"h-5 w-5 mr-1 p-0 hover:bg-gray-200 rounded flex items-center justify-center",onClick:()=>D(v),children:m?e.jsx(z,{className:"h-4 w-4"}):e.jsx(O,{className:"h-4 w-4"})}),l.gerenteComercial||""]})}),e.jsx("td",{className:I("border-r px-4 py-2 text-sm",m&&(l.representante||l.mesAno||l.gerenteComercial)&&"bg-neutral-100"),children:e.jsxs("div",{className:"flex items-center",children:[l.representante&&k&&e.jsx("button",{className:"h-5 w-5 mr-1 p-0 hover:bg-gray-200 rounded flex items-center justify-center",onClick:()=>D(v),children:m?e.jsx(z,{className:"h-4 w-4"}):e.jsx(O,{className:"h-4 w-4"})}),l.representante||""]})}),e.jsx("td",{className:I("border-r px-4 py-2 text-sm",m&&l.grupoCliente&&"bg-neutral-100"),children:e.jsxs("div",{className:"flex items-center",children:[l.grupoCliente&&k&&e.jsx("button",{className:"h-5 w-5 mr-1 p-0 hover:bg-gray-200 rounded flex items-center justify-center",onClick:()=>D(v),children:m?e.jsx(z,{className:"h-4 w-4"}):e.jsx(O,{className:"h-4 w-4"})}),l.grupoCliente||""]})}),e.jsx("td",{className:I("border-r px-4 py-2 text-sm",m&&l.grupoEstoque&&"bg-neutral-100"),children:e.jsxs("div",{className:"flex items-center",children:[l.grupoEstoque&&k&&e.jsx("button",{className:"h-5 w-5 mr-1 p-0 hover:bg-gray-200 rounded flex items-center justify-center",onClick:()=>D(v),children:m?e.jsx(z,{className:"h-4 w-4"}):e.jsx(O,{className:"h-4 w-4"})}),l.grupoEstoque||""]})}),e.jsx("td",{className:"border-r px-4 py-2 text-sm",children:l.familiaComercial||""}),e.jsx("td",{className:"border-r px-4 py-2 text-right text-sm",children:q(l.quantidade)}),e.jsx("td",{className:"border-r px-4 py-2 text-right text-sm",children:q(l.valor)}),e.jsx("td",{className:"px-4 py-2 text-center"})]},v)];return k&&m&&V.push(...M(l.children,v,o+1)),V}):[];return e.jsxs("div",{children:[e.jsxs("div",{className:"mb-2 flex gap-x-4",children:[e.jsxs("div",{className:"flex flex-col space-y-1 flex-1",children:[e.jsx(h,{children:"Representante:"}),e.jsx(ee,{multipleSelect:!0,showSelectButtons:!0,staticItems:g,showValueInSelectedItem:!0,onChange:()=>{},onSelectOption:r=>{const c=r.map(o=>Number(o.value));Q(c)},placeholder:"Selecione os Representantes"},g.length)]}),e.jsxs("div",{className:"flex flex-col space-y-1 flex-1",children:[e.jsx(h,{children:"Família Comercial:"}),e.jsx(ee,{multipleSelect:!0,showSelectButtons:!0,staticItems:a,showValueInSelectedItem:!0,onChange:()=>{},onSelectOption:r=>{const c=r.map(o=>o.value);B(c)},placeholder:"Selecione as Famílias"},a.length)]}),e.jsxs("div",{className:"flex flex-col space-y-1 ",children:[e.jsx(h,{children:"Ano:"}),e.jsx(te,{type:"number",value:C,onChange:r=>E(Number(r.target.value)),step:1,min:2020,max:2072})]}),e.jsxs("div",{className:"flex flex-col space-y-1 ",children:[e.jsx(h,{children:"Mês:"}),e.jsxs(ke,{value:G.toString(),onValueChange:r=>{J(Number(r))},children:[e.jsx(Re,{className:"min-w-[200px]",children:e.jsx(Ee,{placeholder:"Mês"})}),e.jsxs(Fe,{children:[e.jsx(u,{value:"0",children:"Janeiro"}),e.jsx(u,{value:"1",children:"Fevereiro"}),e.jsx(u,{value:"2",children:"Março"}),e.jsx(u,{value:"3",children:"Abril"}),e.jsx(u,{value:"4",children:"Maio"}),e.jsx(u,{value:"5",children:"Junho"}),e.jsx(u,{value:"6",children:"Julho"}),e.jsx(u,{value:"7",children:"Agosto"}),e.jsx(u,{value:"8",children:"Setembro"}),e.jsx(u,{value:"9",children:"Outubro"}),e.jsx(u,{value:"10",children:"Novembro"}),e.jsx(u,{value:"11",children:"Dezembro"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-x-2",children:[e.jsx(x,{className:"mt-4",type:"button",onClick:()=>S.invalidateQueries({queryKey:["rep-goals"]}),children:e.jsx(ze,{className:"size-4"})}),e.jsxs(x,{className:"mt-4",variant:"blue",type:"button",onClick:()=>b(!0),children:[e.jsx(Oe,{className:"size-4"}),"Novo"]}),e.jsxs(x,{className:"mt-4",variant:"blue",type:"button",onClick:()=>y(!0),children:[e.jsx(Le,{className:"size-4"}),"Aplicar Reajuste"]}),e.jsxs(x,{className:"mt-4",variant:"green",onClick:()=>b(!0),children:[e.jsx(Ue,{className:"size-4"}),"Importar"]})]})]}),e.jsx("div",{className:"w-full overflow-auto border rounded-lg",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-200",children:[e.jsx("th",{className:"border-r border-gray-300 px-4 py-3 text-left text-xs font-bold text-black uppercase",children:"MÊS/ANO"}),e.jsx("th",{className:"border-r border-gray-300 px-4 py-3 text-left text-xs font-bold text-black uppercase",children:"GERENTE COMERCIAL"}),e.jsx("th",{className:"border-r border-gray-300 px-4 py-3 text-left text-xs font-bold text-black uppercase",children:"REPRESENTANTE"}),e.jsx("th",{className:"border-r border-gray-300 px-4 py-3 text-left text-xs font-bold text-black uppercase",children:"GRUPO CLIENTE"}),e.jsx("th",{className:"border-r border-gray-300 px-4 py-3 text-left text-xs font-bold text-black uppercase",children:"GRUPO DE ESTOQUE"}),e.jsx("th",{className:"border-r border-gray-300 px-4 py-3 text-left text-xs font-bold text-black uppercase",children:"FAMILIA COMERCIAL"}),e.jsx("th",{className:"border-r border-gray-300 px-4 py-3 text-right text-xs font-bold text-black uppercase",children:"QUANTIDADE"}),e.jsx("th",{className:"border-r border-gray-300 px-4 py-3 text-right text-xs font-bold text-black uppercase",children:"VALOR"}),e.jsx("th",{className:"border-gray-300 px-4 py-3 text-center text-xs font-bold text-black uppercase",children:"AÇÕES"})]})}),e.jsx("tbody",{children:M(A)})]})}),p&&e.jsx(qe,{isOpen:p,onClose:r=>{r&&S.invalidateQueries({queryKey:["rep-goals"]}),b(!1)}}),N&&e.jsx(Qe,{isOpen:N,onClose:r=>{r&&S.invalidateQueries({queryKey:["rep-goals"]}),y(!1)}})]})}const ws=function(){return e.jsx(De,{titleSlot:"Metas de Representates",children:e.jsx("div",{className:"p-2",children:e.jsx(Be,{})})})};export{ws as component};
